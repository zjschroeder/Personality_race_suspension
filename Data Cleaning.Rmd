---
title: "Final Analyses"
author: "Zach Schroeder"
date: "10/12/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, results = FALSE, warning = FALSE)
options(digits = 3)
```

```{r Packages, results='hide', message=FALSE}
library(tidyverse)
library(lme4)
library(nlme)
library(psych)
library(finalfit)
library(naniar)
library(recipes)
library(stringr)
library(reshape2)
library(sjPlot)
library(emmeans)

here::here()
```

# Functions for data cleaning

## Pomp Scoring
```{r Pomp Scoring Function, results='hide', message=FALSE}
pomp <- function(score) {
  score_p  <- (score - min(score, na.rm = T)) / (max(score, na.rm = T) - min(score, na.rm = T)) 
  #IF ERRROR: May need to na.rm = T
  return (10 * score_p)
}

# example
# data <- rnorm(100, mean = 50, sd = 1)
# pomp(data)
```

## Complete Cases
```{r Complete Cases Function, results='hide', message=FALSE}
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}
```

## Scrambled Data Function

>The scramble() function is meant to be applied to a single vector (or variable). 
To apply to an entire dataset, consider the use of a loop or, better yet, tidyverse (included at top of chunk)

```{r Scrambled Function, results='hide', message=FALSE}

# scrambled_data = data 
# %>% mutate(across(everything(), scramble))


scramble_chr = function(x, retain_missing = retain_missing){
  where_miss = which(is.na(x))
  unique_vals = table(x)
  new_x = sample(names(unique_vals),
                 replace = T,
                 size = length(x),
                 prob = unique_vals/sum(unique_vals))
  if(retain_missing){
    new_x[where_miss] = NA
    } else {
      new_x[sample(1:length(x), size = length(where_miss))] = NA
    }
  #check if all numbers, then make numeric
  if(is.numeric(x)) if(sum(grepl("[[:alpha:]]", new_x)) == 0) new_x = as.integer(new_x)
  return(new_x)
  }

scramble_num = function(x, retain_missing = retain_missing){
  where_miss = which(is.na(x))
  mx = mean(x, na.rm=T)
  sx = sd(x, na.rm=T)
  rx = range(x, na.rm=T)
  new_x = rnorm(n = length(x),
                mean = mx,
                sd = sx)
  if(retain_missing){
    new_x[where_miss] = NA
    } else {
      new_x[sample(1:length(x), size = length(where_miss))] = NA
    }
  while(min(new_x, na.rm=T) < rx[1]){
      new_x[new_x == min(new_x, na.rm=T)] = rnorm(1, mean = mx, sd = sx)
    }
  while(max(new_x, na.rm=T) > rx[2]){
      new_x[new_x == max(new_x, na.rm=T)] = rnorm(1, mean = mx, sd = sx)
  }
  return(new_x)
}

scramble = function(x, retain_missing = T){
  n_na = sum(is.na(x))
  if(n_na != length(x)){
    if(is.character(x) | is.factor(x)){
      scramble_chr(x, retain_missing = retain_missing)
      } else {
        if(is.logical(all.equal(x, as.integer(x)))){
          scramble_chr(x, retain_missing = retain_missing)
          } else {
            scramble_num(x, retain_missing = retain_missing)
          }
        }
  } else {
      new_x = x
      return(new_x)}
}


# # test vectors ------------------------------------------------------------
# test1 = sample(c("dog", "cat", "fish", NA), size = 200, replace = T)
# test1_s = scramble(test1)
# table(test1)
# table(test1_s)
# 
# test2 = rbinom(n = 200, size = 7, prob = .5)
# test2_s = scramble(test2)
# table(test2)
# table(test2_s)
# 
# test3 = rnorm(200, m = 5)
# test3[sample(1:200, size = 20)] = NA
# test3_s = scramble(test3)
# mean(test3, na.rm=T); sd(test3, na.rm=T)
# mean(test3_s, na.rm=T); sd(test3_s, na.rm=T)
# cor(test3, test3_s, use = "pairwise")
# 
# library(psychTools)
# data("tai") # has a mix of factor and numeric variables
# 
# library(tidyverse) # for the useful mutate function
# 
# tai_s = tai %>%
# mutate(across(.cols = everything(), scramble)) #give me a scrambled dataset
```

# Data Import and Cleaning

## NLSY Data Preparation 

### Import and Pre-written cleaning

```{r NLSY Import, results='hide', message=FALSE}
new_data <- rio::import(here::here("data", "NLSY_11_19_21/NLSY_11_19_21.csv"))
```

> NLSY is cleaned using NLS Investigator Code included with data download from NLSY site. The code is 1600 lines long and not included in the markdown output. Please see the .Rmd file for NLSY cleaning code

```{r NLSY Cleaning, echo=FALSE, cache=TRUE}
names(new_data) <- c('C0000100',
  'C0000200',
  'C0005300',
  'C0005400',
  'C0005500',
  'C0005700',
  'C0785700',
  'C0785800',
  'C0988400',
  'C0988500',
  'C1186700',
  'C1186800',
  'C1440400',
  'C1440500',
  'C1642800',
  'C1642900',
  'C1983200',
  'C1983300',
  'C2251400',
  'C2251500',
  'C2735000',
  'C2735100',
  'C3007400',
  'C3007500',
  'C3577600',
  'C3577700',
  'C3950100',
  'C3950200',
  'C5194200',
  'C5194300',
  'C5769100',
  'C5769200',
  'C6035900',
  'C6036000',
  'Y0307300',
  'Y0367000',
  'Y0661000',
  'Y0957900',
  'Y1921300',
  'Y1921301',
  'Y1921302',
  'Y1921303',
  'Y1921304',
  'Y1921305',
  'Y1921306',
  'Y1921307',
  'Y1921308',
  'Y1921309',
  'Y2238200',
  'Y2238201',
  'Y2238202',
  'Y2238203',
  'Y2238204',
  'Y2238205',
  'Y2238206',
  'Y2238207',
  'Y2238208',
  'Y2238209',
  'Y2267000',
  'Y2590300',
  'Y2590301',
  'Y2590302',
  'Y2590303',
  'Y2590304',
  'Y2590305',
  'Y2590306',
  'Y2590307',
  'Y2590308',
  'Y2590309',
  'Y2937100',
  'Y2937200',
  'Y2937300',
  'Y2937400',
  'Y2937500',
  'Y2937600',
  'Y2937601',
  'Y2937602',
  'Y2937603',
  'Y2937604',
  'Y2937605',
  'Y2937606',
  'Y2937607',
  'Y2937608',
  'Y2937609',
  'Y2937800',
  'Y2937801',
  'Y2937802',
  'Y2937803',
  'Y2937804',
  'Y2937805',
  'Y2937806',
  'Y2937807',
  'Y2937808',
  'Y2937809',
  'Y2937810',
  'Y2937811',
  'Y2937812',
  'Y2937813',
  'Y2937814',
  'Y2937815',
  'Y2937816',
  'Y2937817',
  'Y2937818',
  'Y2937819',
  'Y3307400',
  'Y3307500',
  'Y3307600',
  'Y3307700',
  'Y3307701',
  'Y3307702',
  'Y3307703',
  'Y3307704',
  'Y3307705',
  'Y3307706',
  'Y3307707',
  'Y3307708',
  'Y3307709',
  'Y3651700',
  'Y3651800',
  'Y3651801',
  'Y3651802',
  'Y3651803',
  'Y3651804',
  'Y3651805',
  'Y3651806',
  'Y3651807',
  'Y3651808',
  'Y3651809',
  'Y4259400',
  'Y4259401',
  'Y4259402',
  'Y4259403',
  'Y4259404',
  'Y4259405',
  'Y4259406',
  'Y4259407',
  'Y4259408',
  'Y4259409')


# Handle missing values

  new_data[new_data == -1] = NA  # Refused 
  new_data[new_data == -2] = NA  # Dont know 
  new_data[new_data == -3] = NA  # Invalid missing 
  new_data[new_data == -7] = NA  # Missing 


# If there are values not categorized they will be represented as NA

vallabels = function(data) {
  data$C0000100[1.0 <= data$C0000100 & data$C0000100 <= 9999999.0] <- 1.0
  data$C0000100 <- factor(data$C0000100, 
    levels=c(1.0), 
    labels=c("1 TO 9999999: See Min & Max values below for range as of this release"))
  data$C0000200[1.0 <= data$C0000200 & data$C0000200 <= 12686.0] <- 1.0
  data$C0000200 <- factor(data$C0000200, 
    levels=c(1.0), 
    labels=c("1 TO 12686: NLSY79 Public ID"))
  data$C0005300 <- factor(data$C0005300, 
    levels=c(1.0,2.0,3.0), 
    labels=c("HISPANIC",
      "BLACK",
      "NON-BLACK, NON-HISPANIC"))
  data$C0005400 <- factor(data$C0005400, 
    levels=c(1.0,2.0), 
    labels=c("MALE",
      "FEMALE"))
  data$C0005500 <- factor(data$C0005500, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0), 
    labels=c("1: JANUARY",
      "2: FEBRUARY",
      "3: MARCH",
      "4: APRIL",
      "5: MAY",
      "6: JUNE",
      "7: JULY",
      "8: AUGUST",
      "9: SEPTEMBER",
      "10: OCTOBER",
      "11: NOVEMBER",
      "12: DECEMBER"))
  data$C0005700[1970.0 <= data$C0005700 & data$C0005700 <= 1978.0] <- 1970.0
  data$C0005700 <- factor(data$C0005700, 
    levels=c(1970.0,1979.0,1980.0,1981.0,1982.0,1983.0,1984.0,1985.0,1986.0,1987.0,1988.0,1989.0,1990.0,1991.0,1992.0,1993.0,1994.0,1995.0,1996.0,1997.0,1998.0,1999.0,2000.0,2001.0,2002.0,2003.0,2004.0,2005.0,2006.0,2007.0,2008.0,2009.0,2010.0,2011.0,2012.0,2013.0,2014.0,2015.0,2016.0,2017.0,2018.0,2019.0), 
    labels=c("1970 TO 1978: < before 1979",
      "1979",
      "1980",
      "1981",
      "1982",
      "1983",
      "1984",
      "1985",
      "1986",
      "1987",
      "1988",
      "1989",
      "1990",
      "1991",
      "1992",
      "1993",
      "1994",
      "1995",
      "1996",
      "1997",
      "1998",
      "1999",
      "2000",
      "2001",
      "2002",
      "2003",
      "2004",
      "2005",
      "2006",
      "2007",
      "2008",
      "2009",
      "2010",
      "2011",
      "2012",
      "2013",
      "2014",
      "2015",
      "2016",
      "2017",
      "2018",
      "2019"))
  data$C0785700 <- factor(data$C0785700, 
    levels=c(0.0,1.0), 
    labels=c("NO",
      "YES"))
  data$C0785800[17.0 <= data$C0785800 & data$C0785800 <= 99999.0] <- 17.0
  data$C0785800 <- factor(data$C0785800, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0), 
    labels=c("0: < 1",
      "1",
      "2",
      "3",
      "4",
      "5",
      "6",
      "7",
      "8",
      "9",
      "10",
      "11",
      "12",
      "13",
      "14",
      "15",
      "16",
      "17 TO 99999: 17+"))
  data$C0988400 <- factor(data$C0988400, 
    levels=c(0.0,1.0), 
    labels=c("NO",
      "YES"))
  data$C0988500[17.0 <= data$C0988500 & data$C0988500 <= 99999.0] <- 17.0
  data$C0988500 <- factor(data$C0988500, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0), 
    labels=c("0: < 1",
      "1",
      "2",
      "3",
      "4",
      "5",
      "6",
      "7",
      "8",
      "9",
      "10",
      "11",
      "12",
      "13",
      "14",
      "15",
      "16",
      "17 TO 99999: 17+"))
  data$C1186700 <- factor(data$C1186700, 
    levels=c(0.0,1.0), 
    labels=c("NO",
      "YES"))
  data$C1186800[17.0 <= data$C1186800 & data$C1186800 <= 99999.0] <- 17.0
  data$C1186800 <- factor(data$C1186800, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0), 
    labels=c("0: < 1",
      "1",
      "2",
      "3",
      "4",
      "5",
      "6",
      "7",
      "8",
      "9",
      "10",
      "11",
      "12",
      "13",
      "14",
      "15",
      "16",
      "17 TO 99999: 17+"))
  data$C1440400 <- factor(data$C1440400, 
    levels=c(0.0,1.0), 
    labels=c("NO",
      "YES"))
  data$C1440500[16.0 <= data$C1440500 & data$C1440500 <= 99999.0] <- 16.0
  data$C1440500 <- factor(data$C1440500, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0), 
    labels=c("0",
      "1",
      "2",
      "3",
      "4",
      "5",
      "6",
      "7",
      "8",
      "9",
      "10",
      "11",
      "12",
      "13",
      "14",
      "15",
      "16 TO 99999: 16+"))
  data$C1642800 <- factor(data$C1642800, 
    levels=c(0.0,1.0), 
    labels=c("No",
      "Yes"))
  data$C1642900 <- factor(data$C1642900, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,95.0), 
    labels=c("0: KINDERGARTEN",
      "1: 1ST GRADE",
      "2: 2ND GRADE",
      "3: 3RD GRADE",
      "4: 4TH GRADE",
      "5: 5TH GRADE",
      "6: 6TH GRADE",
      "7: 7TH GRADE",
      "8: 8TH GRADE",
      "9: 9TH GRADE",
      "10: 10TH GRADE",
      "11: 11TH GRADE",
      "12: 12TH GRADE",
      "95: DOES NOT APPLY"))
  data$C1983200 <- factor(data$C1983200, 
    levels=c(0.0,1.0), 
    labels=c("No",
      "Yes"))
  data$C1983300 <- factor(data$C1983300, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,95.0), 
    labels=c("0: KINDERGARTEN",
      "1: 1ST GRADE",
      "2: 2ND GRADE",
      "3: 3RD GRADE",
      "4: 4TH GRADE",
      "5: 5TH GRADE",
      "6: 6TH GRADE",
      "7: 7TH GRADE",
      "8: 8TH GRADE",
      "9: 9TH GRADE",
      "10: 10TH GRADE",
      "11: 11TH GRADE",
      "12: 12TH GRADE",
      "95: DOES NOT APPLY"))
  data$C2251400 <- factor(data$C2251400, 
    levels=c(0.0,1.0), 
    labels=c("No",
      "Yes"))
  data$C2251500 <- factor(data$C2251500, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,90.0), 
    labels=c("KINDERGARTEN",
      "1ST GRADE",
      "2ND GRADE",
      "3RD GRADE",
      "4TH GRADE",
      "5TH GRADE",
      "6TH GRADE",
      "7TH GRADE",
      "8TH GRADE",
      "9TH GRADE",
      "10TH GRADE",
      "11TH GRADE",
      "12TH GRADE",
      "NURSERY/PRESCHOOL"))
  data$C2735000 <- factor(data$C2735000, 
    levels=c(0.0,1.0), 
    labels=c("No",
      "Yes"))
  data$C2735100 <- factor(data$C2735100, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,90.0), 
    labels=c("KINDERGARTEN",
      "1ST GRADE",
      "2ND GRADE",
      "3RD GRADE",
      "4TH GRADE",
      "5TH GRADE",
      "6TH GRADE",
      "7TH GRADE",
      "8TH GRADE",
      "9TH GRADE",
      "10TH GRADE",
      "11TH GRADE",
      "12TH GRADE",
      "NURSERY/PRESCHOOL"))
  data$C3007400 <- factor(data$C3007400, 
    levels=c(0.0,1.0), 
    labels=c("No",
      "Yes"))
  data$C3007500 <- factor(data$C3007500, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,90.0), 
    labels=c("KINDERGARTEN",
      "1ST GRADE",
      "2ND GRADE",
      "3RD GRADE",
      "4TH GRADE",
      "5TH GRADE",
      "6TH GRADE",
      "7TH GRADE",
      "8TH GRADE",
      "9TH GRADE",
      "10TH GRADE",
      "11TH GRADE",
      "12TH GRADE",
      "NURSERY/PRESCHOOL"))
  data$C3577600 <- factor(data$C3577600, 
    levels=c(0.0,1.0), 
    labels=c("No",
      "Yes"))
  data$C3577700 <- factor(data$C3577700, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,90.0), 
    labels=c("KINDERGARTEN",
      "1ST GRADE",
      "2ND GRADE",
      "3RD GRADE",
      "4TH GRADE",
      "5TH GRADE",
      "6TH GRADE",
      "7TH GRADE",
      "8TH GRADE",
      "9TH GRADE",
      "10TH GRADE",
      "11TH GRADE",
      "12TH GRADE",
      "NURSERY/PRESCHOOL"))
  data$C3950100 <- factor(data$C3950100, 
    levels=c(0.0,1.0), 
    labels=c("No",
      "Yes"))
  data$C3950200 <- factor(data$C3950200, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,90.0), 
    labels=c("KINDERGARTEN",
      "1ST GRADE",
      "2ND GRADE",
      "3RD GRADE",
      "4TH GRADE",
      "5TH GRADE",
      "6TH GRADE",
      "7TH GRADE",
      "8TH GRADE",
      "9TH GRADE",
      "10TH GRADE",
      "11TH GRADE",
      "12TH GRADE",
      "NURSERY/PRESCHOOL"))
  data$C5194200 <- factor(data$C5194200, 
    levels=c(0.0,1.0), 
    labels=c("No",
      "Yes"))
  data$C5194300 <- factor(data$C5194300, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,90.0), 
    labels=c("KINDERGARTEN",
      "1ST GRADE",
      "2ND GRADE",
      "3RD GRADE",
      "4TH GRADE",
      "5TH GRADE",
      "6TH GRADE",
      "7TH GRADE",
      "8TH GRADE",
      "9TH GRADE",
      "10TH GRADE",
      "11TH GRADE",
      "12TH GRADE",
      "NURSERY/PRESCHOOL"))
  data$C5769100 <- factor(data$C5769100, 
    levels=c(0.0,1.0), 
    labels=c("No",
      "Yes"))
  data$C5769200 <- factor(data$C5769200, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,90.0), 
    labels=c("KINDERGARTEN",
      "1ST GRADE",
      "2ND GRADE",
      "3RD GRADE",
      "4TH GRADE",
      "5TH GRADE",
      "6TH GRADE",
      "7TH GRADE",
      "8TH GRADE",
      "9TH GRADE",
      "10TH GRADE",
      "11TH GRADE",
      "12TH GRADE",
      "NURSERY/PRESCHOOL"))
  data$C6035900 <- factor(data$C6035900, 
    levels=c(0.0,1.0), 
    labels=c("No",
      "Yes"))
  data$C6036000 <- factor(data$C6036000, 
    levels=c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,90.0), 
    labels=c("KINDERGARTEN",
      "1ST GRADE",
      "2ND GRADE",
      "3RD GRADE",
      "4TH GRADE",
      "5TH GRADE",
      "6TH GRADE",
      "7TH GRADE",
      "8TH GRADE",
      "9TH GRADE",
      "10TH GRADE",
      "11TH GRADE",
      "12TH GRADE",
      "NURSERY/PRESCHOOL"))
  data$Y0307300 <- factor(data$Y0307300, 
    levels=c(0.0,1.0), 
    labels=c("CONDITION DOES NOT APPLY",
      "CONDITION APPLIES"))
  data$Y0367000 <- factor(data$Y0367000, 
    levels=c(1.0,2.0,3.0,4.0), 
    labels=c("1: NEVER",
      "2: ONCE IN A WHILE",
      "3: FAIRLY OFTEN",
      "4: VERY OFTEN"))
  data$Y0661000 <- factor(data$Y0661000, 
    levels=c(1.0,2.0,3.0,4.0), 
    labels=c("1: NEVER",
      "2: ONCE IN A WHILE",
      "3: FAIRLY OFTEN",
      "4: VERY OFTEN"))
  data$Y0957900 <- factor(data$Y0957900, 
    levels=c(1.0,2.0,3.0,4.0), 
    labels=c("NEVER",
      "ONCE IN A WHILE",
      "FAIRLY OFTEN",
      "VERY OFTEN"))
  data$Y1921300 <- factor(data$Y1921300, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y1921301 <- factor(data$Y1921301, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y1921302 <- factor(data$Y1921302, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y1921303 <- factor(data$Y1921303, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y1921304 <- factor(data$Y1921304, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y1921305 <- factor(data$Y1921305, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y1921306 <- factor(data$Y1921306, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y1921307 <- factor(data$Y1921307, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y1921308 <- factor(data$Y1921308, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y1921309 <- factor(data$Y1921309, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2238200 <- factor(data$Y2238200, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2238201 <- factor(data$Y2238201, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2238202 <- factor(data$Y2238202, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2238203 <- factor(data$Y2238203, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2238204 <- factor(data$Y2238204, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2238205 <- factor(data$Y2238205, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2238206 <- factor(data$Y2238206, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2238207 <- factor(data$Y2238207, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2238208 <- factor(data$Y2238208, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2238209 <- factor(data$Y2238209, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2267000 <- factor(data$Y2267000, 
    levels=c(506.0), 
    labels=c("506"))
  data$Y2590300 <- factor(data$Y2590300, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2590301 <- factor(data$Y2590301, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2590302 <- factor(data$Y2590302, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2590303 <- factor(data$Y2590303, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2590304 <- factor(data$Y2590304, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2590305 <- factor(data$Y2590305, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2590306 <- factor(data$Y2590306, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2590307 <- factor(data$Y2590307, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2590308 <- factor(data$Y2590308, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2590309 <- factor(data$Y2590309, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2937100 <- factor(data$Y2937100, 
    levels=c(0.0,1.0), 
    labels=c("0: CONDITION DOES NOT APPLY",
      "1: CONDITION APPLIES"))
  data$Y2937200 <- factor(data$Y2937200, 
    levels=c(0.0,1.0), 
    labels=c("0: NA FOR SECOND RANDOMIZATION",
      "1: SELECTED FOR SECOND RANDOMIZATION"))
  data$Y2937300 <- factor(data$Y2937300, 
    levels=c(0.0,1.0), 
    labels=c("0: NA TO COMPLETE BOTH TIPI AND MINI-IPIP",
      "1: SELECTED TO COMPLETE BOTH TIPI AND MINI-IPIP"))
  data$Y2937400 <- factor(data$Y2937400, 
    levels=c(0.0,1.0), 
    labels=c("0: NA FOR SECOND RANDOMIZATION",
      "1: SELECTED FOR SECOND RANDOMIZATION"))
  data$Y2937500 <- factor(data$Y2937500, 
    levels=c(0.0,1.0), 
    labels=c("0: NA TO COMPLETE BOTH TIPI AND MINI-IPIP",
      "1: SELECTED TO COMPLETE BOTH TIPI AND MINI-IPIP"))
  data$Y2937600 <- factor(data$Y2937600, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2937601 <- factor(data$Y2937601, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2937602 <- factor(data$Y2937602, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2937603 <- factor(data$Y2937603, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2937604 <- factor(data$Y2937604, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2937605 <- factor(data$Y2937605, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2937606 <- factor(data$Y2937606, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2937607 <- factor(data$Y2937607, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2937608 <- factor(data$Y2937608, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2937609 <- factor(data$Y2937609, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y2937800 <- factor(data$Y2937800, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937801 <- factor(data$Y2937801, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937802 <- factor(data$Y2937802, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937803 <- factor(data$Y2937803, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937804 <- factor(data$Y2937804, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937805 <- factor(data$Y2937805, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937806 <- factor(data$Y2937806, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937807 <- factor(data$Y2937807, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937808 <- factor(data$Y2937808, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937809 <- factor(data$Y2937809, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937810 <- factor(data$Y2937810, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937811 <- factor(data$Y2937811, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937812 <- factor(data$Y2937812, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937813 <- factor(data$Y2937813, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937814 <- factor(data$Y2937814, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937815 <- factor(data$Y2937815, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937816 <- factor(data$Y2937816, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937817 <- factor(data$Y2937817, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937818 <- factor(data$Y2937818, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y2937819 <- factor(data$Y2937819, 
    levels=c(1.0,2.0,3.0,4.0,5.0), 
    labels=c("Very Inaccurate",
      "Moderately Inaccurate",
      "Neither Accurate Nor Inaccurate",
      "Moderately Accurate",
      "Very Accurate"))
  data$Y3307400 <- factor(data$Y3307400, 
    levels=c(0.0,1.0), 
    labels=c("0: NA FOR SECOND RANDOMIZATION",
      "1: SELECTED FOR SECOND RANDOMIZATION"))
  data$Y3307500 <- factor(data$Y3307500, 
    levels=c(0.0,1.0), 
    labels=c("0: NA FOR THIRD RANDOMIZATION",
      "1: SELECTED FOR THIRD RANDOMIZATION"))
  data$Y3307600 <- factor(data$Y3307600, 
    levels=c(0.0,1.0), 
    labels=c("0: NA TO COMPLETE BOTH TIPI AND MINI-IPIP",
      "1: SELECTED TO COMPLETE BOTH TIPI AND MINI-IPIP"))
  data$Y3307700 <- factor(data$Y3307700, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3307701 <- factor(data$Y3307701, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3307702 <- factor(data$Y3307702, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3307703 <- factor(data$Y3307703, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3307704 <- factor(data$Y3307704, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3307705 <- factor(data$Y3307705, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3307706 <- factor(data$Y3307706, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3307707 <- factor(data$Y3307707, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3307708 <- factor(data$Y3307708, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3307709 <- factor(data$Y3307709, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3651700 <- factor(data$Y3651700, 
    levels=c(0.0,1.0), 
    labels=c("0: CONDITION DOES NOT APPLY",
      "1: CONDITION APPLIES"))
  data$Y3651800 <- factor(data$Y3651800, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3651801 <- factor(data$Y3651801, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3651802 <- factor(data$Y3651802, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3651803 <- factor(data$Y3651803, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3651804 <- factor(data$Y3651804, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3651805 <- factor(data$Y3651805, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3651806 <- factor(data$Y3651806, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3651807 <- factor(data$Y3651807, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3651808 <- factor(data$Y3651808, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y3651809 <- factor(data$Y3651809, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- Disagree strongly",
      "2 -- Disagree moderately",
      "3 -- Disagree a little",
      "4 -- Neither agree nor disagree",
      "5 -- Agree a little",
      "6 -- Agree moderately",
      "7 -- Agree strongly"))
  data$Y4259400 <- factor(data$Y4259400, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- DISAGREE STRONGLY",
      "2 -- DISAGREE MODERATELY",
      "3 -- DISAGREE A LITTLE",
      "4 -- NEITHER AGREE NOR DISAGREE",
      "5 -- AGREE A LITTLE",
      "6 -- AGREE MODERATELY",
      "7 -- AGREE STRONGLY"))
  data$Y4259401 <- factor(data$Y4259401, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- DISAGREE STRONGLY",
      "2 -- DISAGREE MODERATELY",
      "3 -- DISAGREE A LITTLE",
      "4 -- NEITHER AGREE NOR DISAGREE",
      "5 -- AGREE A LITTLE",
      "6 -- AGREE MODERATELY",
      "7 -- AGREE STRONGLY"))
  data$Y4259402 <- factor(data$Y4259402, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- DISAGREE STRONGLY",
      "2 -- DISAGREE MODERATELY",
      "3 -- DISAGREE A LITTLE",
      "4 -- NEITHER AGREE NOR DISAGREE",
      "5 -- AGREE A LITTLE",
      "6 -- AGREE MODERATELY",
      "7 -- AGREE STRONGLY"))
  data$Y4259403 <- factor(data$Y4259403, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- DISAGREE STRONGLY",
      "2 -- DISAGREE MODERATELY",
      "3 -- DISAGREE A LITTLE",
      "4 -- NEITHER AGREE NOR DISAGREE",
      "5 -- AGREE A LITTLE",
      "6 -- AGREE MODERATELY",
      "7 -- AGREE STRONGLY"))
  data$Y4259404 <- factor(data$Y4259404, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- DISAGREE STRONGLY",
      "2 -- DISAGREE MODERATELY",
      "3 -- DISAGREE A LITTLE",
      "4 -- NEITHER AGREE NOR DISAGREE",
      "5 -- AGREE A LITTLE",
      "6 -- AGREE MODERATELY",
      "7 -- AGREE STRONGLY"))
  data$Y4259405 <- factor(data$Y4259405, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- DISAGREE STRONGLY",
      "2 -- DISAGREE MODERATELY",
      "3 -- DISAGREE A LITTLE",
      "4 -- NEITHER AGREE NOR DISAGREE",
      "5 -- AGREE A LITTLE",
      "6 -- AGREE MODERATELY",
      "7 -- AGREE STRONGLY"))
  data$Y4259406 <- factor(data$Y4259406, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- DISAGREE STRONGLY",
      "2 -- DISAGREE MODERATELY",
      "3 -- DISAGREE A LITTLE",
      "4 -- NEITHER AGREE NOR DISAGREE",
      "5 -- AGREE A LITTLE",
      "6 -- AGREE MODERATELY",
      "7 -- AGREE STRONGLY"))
  data$Y4259407 <- factor(data$Y4259407, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- DISAGREE STRONGLY",
      "2 -- DISAGREE MODERATELY",
      "3 -- DISAGREE A LITTLE",
      "4 -- NEITHER AGREE NOR DISAGREE",
      "5 -- AGREE A LITTLE",
      "6 -- AGREE MODERATELY",
      "7 -- AGREE STRONGLY"))
  data$Y4259408 <- factor(data$Y4259408, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- DISAGREE STRONGLY",
      "2 -- DISAGREE MODERATELY",
      "3 -- DISAGREE A LITTLE",
      "4 -- NEITHER AGREE NOR DISAGREE",
      "5 -- AGREE A LITTLE",
      "6 -- AGREE MODERATELY",
      "7 -- AGREE STRONGLY"))
  data$Y4259409 <- factor(data$Y4259409, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0,7.0), 
    labels=c("1 -- DISAGREE STRONGLY",
      "2 -- DISAGREE MODERATELY",
      "3 -- DISAGREE A LITTLE",
      "4 -- NEITHER AGREE NOR DISAGREE",
      "5 -- AGREE A LITTLE",
      "6 -- AGREE MODERATELY",
      "7 -- AGREE STRONGLY"))
  return(data)
}

varlabels <- c("ID CODE OF CHILD",
  "ID CODE OF MOTHER OF CHILD",
  "RACE OF CHILD (FROM MOTHERS SCREENER 79)",
  "SEX OF CHILD",
  "DATE OF BIRTH OF CHILD - MONTH",
  "DATE OF BIRTH OF CHILD - YEAR",
  "CHILD EVER SUSPENDED FROM SCHOOL",
  "CHILDS GRADE WHEN SUSPENDED",
  "HAS CHILD EVER BEEN SUSPENDED/EXPELLED",
  "WHAT GRADE DID THIS HAPPEN",
  "HAS CH EVER BEEN SUSPENDED/EXPELLED?-92",
  "WHAT GRADE CH 1ST SUSPENDED/EXPELLED?-92",
  "MS CHILD EVER SUSPENDED/EXPELLED? 94",
  "MS WHEN DID SUSPEND/EXPEL 1ST HAPPEN 94",
  "MS CHILD EVER SUSPENDED/EXPELLED 96",
  "MS WHEN DID SUSPEND/EXPEL 1ST HAPPEN 96",
  "MS CHILD EVER SUSPENDED/EXPELLED 1998",
  "MS WHEN DID SUSPEND/EXPEL 1ST HAPPN 1998",
  "CHILD EVER SUSPENDED/EXPELLED 2000",
  "WHEN DID SUSPEND/EXPEL 1ST HAPPEN 2000",
  "CHILD EVER SUSPENDED/EXPELLED 2002",
  "WHEN DID SUSPEND/EXPEL 1ST HAPPEN 2002",
  "CHILD EVER SUSPENDED/EXPELLED 2004",
  "WHEN DID SUSPEND/EXPEL 1ST HAPPEN 2004",
  "CHILD EVER SUSPENDED/EXPELLED 2006",
  "WHEN DID SUSPEND/EXPEL 1ST HAPPEN 2006",
  "CHILD EVER SUSPENDED/EXPELLED 2008",
  "WHEN DID SUSPEND/EXPEL 1ST HAPPEN 2008",
  "CHILD EVER SUSPENDED/EXPELLED 2010",
  "WHEN DID SUSPEND/EXPEL 1ST HAPPEN 2010",
  "CHILD EVER SUSPENDED/EXPELLED 2012",
  "WHEN DID SUSPEND/EXPEL 1ST HAPPEN 2012",
  "CHILD EVER SUSPENDED/EXPELLED 2014",
  "WHEN DID SUSPEND/EXPEL 1ST HAPPEN 2014",
  "BRANCH ON GENDER OF R          94 1994",
  "WHEN HIGH GRADES SUFFERED             94 1994",
  "WHEN HIGH GRADES SUFFERED             96 1996",
  "WHEN HIGH GRADES SUFFERED 1998",
  "TIPI (HW APPLIES TO R) - EXTRAVERTED, ENTHUSIASTIC 2006",
  "TIPI (HW APPLIES TO R) - CRITICAL, QUARRLESOME 2006",
  "TIPI (HW APPLIES TO R) - DEPENDABLE, SELF-DISCIPLN 2006",
  "TIPI (HW APPLIES TO R) - ANXIOUS, EASILY UPSET 2006",
  "TIPI (HW APPLIES TO R) - OPEN TO NEW EXPER, COMPLX 2006",
  "TIPI (HW APPLIES TO R) - RESERVED, QUIET 2006",
  "TIPI (HW APPLIES TO R) - SYMPATHETIC, WARM 2006",
  "TIPI (HW APPLIES TO R) - DISORGANIZED, CARELESS 2006",
  "TIPI (HW APPLIES TO R) - CALM, EMOTIONALLY STABLE 2006",
  "TIPI (HW APPLIES TO R) - CONVENTIONAL, UNCREATIVE 2006",
  "TIPI (HW APPLIES TO R) - EXTRAVERTED, ENTHUSIASTIC 2008",
  "TIPI (HW APPLIES TO R) - CRITICAL, QUARRLESOME 2008",
  "TIPI (HW APPLIES TO R) - DEPENDABLE, SELF-DISCIPLN 2008",
  "TIPI (HW APPLIES TO R) - ANXIOUS, EASILY UPSET 2008",
  "TIPI (HW APPLIES TO R) - OPEN TO NEW EXPER, COMPLX 2008",
  "TIPI (HW APPLIES TO R) - RESERVED, QUIET 2008",
  "TIPI (HW APPLIES TO R) - SYMPATHETIC, WARM 2008",
  "TIPI (HW APPLIES TO R) - DISORGANIZED, CARELESS 2008",
  "TIPI (HW APPLIES TO R) - CALM, EMOTIONALLY STABLE 2008",
  "TIPI (HW APPLIES TO R) - CONVENTIONAL, UNCREATIVE 2008",
  "VERSION_R28 CHILD/YOUNG ADULT XRND",
  "TIPI (HW APPLIES TO R) - EXTRAVERTED, ENTHUSIASTIC 2010",
  "TIPI (HW APPLIES TO R) - CRITICAL, QUARRLESOME 2010",
  "TIPI (HW APPLIES TO R) - DEPENDABLE, SELF-DISCIPLN 2010",
  "TIPI (HW APPLIES TO R) - ANXIOUS, EASILY UPSET 2010",
  "TIPI (HW APPLIES TO R) - OPEN TO NEW EXPER, COMPLX 2010",
  "TIPI (HW APPLIES TO R) - RESERVED, QUIET 2010",
  "TIPI (HW APPLIES TO R) - SYMPATHETIC, WARM 2010",
  "TIPI (HW APPLIES TO R) - DISORGANIZED, CARELESS 2010",
  "TIPI (HW APPLIES TO R) - CALM, EMOTIONALLY STABLE 2010",
  "TIPI (HW APPLIES TO R) - CONVENTIONAL, UNCREATIVE 2010",
  "CHECK:  R INT AS YA IN 10 2012",
  "1ST FLAG FOR RAND YAS INTV 2010 FOR TIPI/MINI-IPIP 2012",
  "2ND FLAG FOR RAND YAS INTV 2010 FOR TIPI/MINI-IPIP 2012",
  "1ST FLAG FOR RAND YAS NONINT 2010 TIPI/MINI-IPIP 2012",
  "2ND FLAG FOR RAND YAS NONINT 2010 TIPI/MINI-IPIP 2012",
  "TIPI (HW APPLIES TO R) - EXTRAVERTED, ENTHUSIASTIC 2012",
  "TIPI (HW APPLIES TO R) - CRITICAL, QUARRLESOME 2012",
  "TIPI (HW APPLIES TO R) - DEPENDABLE, SELF-DISCIPLN 2012",
  "TIPI (HW APPLIES TO R) - ANXIOUS, EASILY UPSET 2012",
  "TIPI (HW APPLIES TO R) - OPEN TO NEW EXPER, COMPLX 2012",
  "TIPI (HW APPLIES TO R) - RESERVED, QUIET 2012",
  "TIPI (HW APPLIES TO R) - SYMPATHETIC, WARM 2012",
  "TIPI (HW APPLIES TO R) - DISORGANIZED, CARELESS 2012",
  "TIPI (HW APPLIES TO R) - CALM, EMOTIONALLY STABLE 2012",
  "TIPI (HW APPLIES TO R) - CONVENTIONAL, UNCREATIVE 2012",
  "MINI-IPIP (HW ACCU DESC R) - I AM LIFE OF PARTY 2012",
  "MINI-IPIP (HW ACCU DESC R) - I SYMP W/ OTH FEELNGS 2012",
  "MINI-IPIP (HW ACCU DESC R) - GET CHORES DN RT AWAY 2012",
  "MINI-IPIP (HW ACCU DESC R) - I HV FREQ MOOD SWINGS 2012",
  "MINI-IPIP (HW ACCU DESC R) - HV A VIVID IMAGINATN 2012",
  "MINI-IPIP (HW ACCU DESC R) - I DONT TALK A LOT 2012",
  "MINI-IPIP (HW AC DESC R) - NOT INT IN OTH PPL PROB 2012",
  "MINI-IPIP (HW DESC R) -  FORGET TO PUT THINGS BACK 2012",
  "MINI-IPIP (HW ACCU DESC R) - RELAXED MOST OF TIME 2012",
  "MINI-IPIP (HW ACCU DESC R) - NOT INT IN ABST IDEAS 2012",
  "MINI-IPIP (HW DESC R) - TLK TO MANY PPL AT PARTIES 2012",
  "MINI-IPIP (HW DESC R) - I FEEL OTHERS EMOTIONS 2012",
  "MINI-IPIP (HW ACCU DESC R) - I LIKE ORDER 2012",
  "MINI-IPIP (HW ACCU DESC R) - I GET UPSET EASILY 2012",
  "MINI-IPIP (HW ACCU DESC R) - DIFF UNDERST AB IDEAS 2012",
  "MINI-IPIP (HW ACCU DESC R) - I KEEP IN BACKGROUND 2012",
  "MINI-IPIP (HW DESC R) - NOT REALLY INTEREST IN OTH 2012",
  "MINI-IPIP (HW AC DESC R) - I MAKE A MESS OF THINGS 2012",
  "MINI-IPIP (HW ACCU DESC R) - SELDOM FEEL BLUE 2012",
  "MINI-IPIP (HW DESC R) - DO NOT HV A GD IMAGINATION 2012",
  "1ST FLAG FOR RAND SUBSET OF RS FOR TIPI/MINI-IPIP 2014",
  "2ND FLAG FOR RAND SUBSET OF RS FOR TIPI/MINI-IPIP 2014",
  "3RD  FLAG FOR RAND SUBSET OF RS FOR TIPI/MINI-IPIP 2014",
  "TIPI (HW APPLIES TO R) - EXTRAVERTED, ENTHUSIASTIC 2014",
  "TIPI (HW APPLIES TO R) - CRITICAL, QUARRLESOME 2014",
  "TIPI (HW APPLIES TO R) - DEPENDABLE, SELF-DISCIPLN 2014",
  "TIPI (HW APPLIES TO R) - ANXIOUS, EASILY UPSET 2014",
  "TIPI (HW APPLIES TO R) - OPEN TO NEW EXPER, COMPLX 2014",
  "TIPI (HW APPLIES TO R) - RESERVED, QUIET 2014",
  "TIPI (HW APPLIES TO R) - SYMPATHETIC, WARM 2014",
  "TIPI (HW APPLIES TO R) - DISORGANIZED, CARELESS 2014",
  "TIPI (HW APPLIES TO R) - CALM, EMOTIONALLY STABLE 2014",
  "TIPI (HW APPLIES TO R) - CONVENTIONAL, UNCREATIVE 2014",
  "CHECK:  R INT AS YA IN 14 2016",
  "TIPI (HW APPLIES TO R) - EXTRAVERTED, ENTHUSIASTIC 2016",
  "TIPI (HW APPLIES TO R) - CRITICAL, QUARRLESOME 2016",
  "TIPI (HW APPLIES TO R) - DEPENDABLE, SELF-DISCIPLN 2016",
  "TIPI (HW APPLIES TO R) - ANXIOUS, EASILY UPSET 2016",
  "TIPI (HW APPLIES TO R) - OPEN TO NEW EXPER, COMPLX 2016",
  "TIPI (HW APPLIES TO R) - RESERVED, QUIET 2016",
  "TIPI (HW APPLIES TO R) - SYMPATHETIC, WARM 2016",
  "TIPI (HW APPLIES TO R) - DISORGANIZED, CARELESS 2016",
  "TIPI (HW APPLIES TO R) - CALM, EMOTIONALLY STABLE 2016",
  "TIPI (HW APPLIES TO R) - CONVENTIONAL, UNCREATIVE 2016",
  "TIPI (HW APPLIES TO R) - EXTRAVERTED, ENTHUSIASTIC 2018",
  "TIPI (HW APPLIES TO R) - CRITICAL, QUARRLESOME 2018",
  "TIPI (HW APPLIES TO R) - DEPENDABLE, SELF-DISCIPLN 2018",
  "TIPI (HW APPLIES TO R) - ANXIOUS, EASILY UPSET 2018",
  "TIPI (HW APPLIES TO R) - OPEN TO NEW EXPER, COMPLX 2018",
  "TIPI (HW APPLIES TO R) - RESERVED, QUIET 2018",
  "TIPI (HW APPLIES TO R) - SYMPATHETIC, WARM 2018",
  "TIPI (HW APPLIES TO R) - DISORGANIZED, CARELESS 2018",
  "TIPI (HW APPLIES TO R) - CALM, EMOTIONALLY STABLE 2018",
  "TIPI (HW APPLIES TO R) - CONVENTIONAL, UNCREATIVE 2018"
)


# Use qnames rather than rnums

qnames = function(data) {
  names(data) <- c("pid",
    "MPUBID_XRND",
    "race",
    "sex",
    "month",
    "year",
    "ever_1988",
    "grade_1988",
    "ever_1990",
    "grade_1990",
    "ever_1992",
    "grade_1992",
    "ever_1994",
    "grade_1994",
    "ever_1996",
    "grade_1996",
    "ever_1998",
    "grade_1998",
    "ever_2000",
    "grade_2000",
    "ever_2002",
    "grade_2002",
    "ever_2004",
    "grade_2004",
    "ever_2006",
    "grade_2006",
    "ever_2008",
    "grade_2008",
    "ever_2010",
    "grade_2010",
    "ever_2012",
    "grade_2012",
    "ever_2014",
    "grade_2014",
    "machine_sex",
    "high1",
    "high2",
    "high3",
    "Q16-9~000001_2006",
    "Q16-9~000002_2006",
    "Q16-9~000003_2006",
    "Q16-9~000004_2006",
    "Q16-9~000005_2006",
    "Q16-9~000006_2006",
    "Q16-9~000007_2006",
    "Q16-9~000008_2006",
    "Q16-9~000009_2006",
    "Q16-9~000010_2006",
    "Q16-9~000001_2008",
    "Q16-9~000002_2008",
    "Q16-9~000003_2008",
    "Q16-9~000004_2008",
    "Q16-9~000005_2008",
    "Q16-9~000006_2008",
    "Q16-9~000007_2008",
    "Q16-9~000008_2008",
    "Q16-9~000009_2008",
    "Q16-9~000010_2008",
    "VERSION_R28_XRND",
    "Q16-9~000001_2010",
    "Q16-9~000002_2010",
    "Q16-9~000003_2010",
    "Q16-9~000004_2010",
    "Q16-9~000005_2010",
    "Q16-9~000006_2010",
    "Q16-9~000007_2010",
    "Q16-9~000008_2010",
    "Q16-9~000009_2010",
    "Q16-9~000010_2010",
    "Q16-8G_2012",
    "Q16-8GB_2012",
    "Q16-8GD_2012",
    "Q16-8GG_2012",
    "Q16-8GI_2012",
    "Q16-9~000001_2012",
    "Q16-9~000002_2012",
    "Q16-9~000003_2012",
    "Q16-9~000004_2012",
    "Q16-9~000005_2012",
    "Q16-9~000006_2012",
    "Q16-9~000007_2012",
    "Q16-9~000008_2012",
    "Q16-9~000009_2012",
    "Q16-9~000010_2012",
    "Q16-9A~000001_2012",
    "Q16-9A~000002_2012",
    "Q16-9A~000003_2012",
    "Q16-9A~000004_2012",
    "Q16-9A~000005_2012",
    "Q16-9A~000006_2012",
    "Q16-9A~000007_2012",
    "Q16-9A~000008_2012",
    "Q16-9A~000009_2012",
    "Q16-9A~000010_2012",
    "Q16-9A~000011_2012",
    "Q16-9A~000012_2012",
    "Q16-9A~000013_2012",
    "Q16-9A~000014_2012",
    "Q16-9A~000015_2012",
    "Q16-9A~000016_2012",
    "Q16-9A~000017_2012",
    "Q16-9A~000018_2012",
    "Q16-9A~000019_2012",
    "Q16-9A~000020_2012",
    "Q16-8GB_2014",
    "Q16-8GD_2014",
    "Q16-8GDA_2014",
    "Q16-9~000001_2014",
    "Q16-9~000002_2014",
    "Q16-9~000003_2014",
    "Q16-9~000004_2014",
    "Q16-9~000005_2014",
    "Q16-9~000006_2014",
    "Q16-9~000007_2014",
    "Q16-9~000008_2014",
    "Q16-9~000009_2014",
    "Q16-9~000010_2014",
    "Q16-8G_2016",
    "Q16-9~000001_2016",
    "Q16-9~000002_2016",
    "Q16-9~000003_2016",
    "Q16-9~000004_2016",
    "Q16-9~000005_2016",
    "Q16-9~000006_2016",
    "Q16-9~000007_2016",
    "Q16-9~000008_2016",
    "Q16-9~000009_2016",
    "Q16-9~000010_2016",
    "Q16-9~000001_2018",
    "Q16-9~000002_2018",
    "Q16-9~000003_2018",
    "Q16-9~000004_2018",
    "Q16-9~000005_2018",
    "Q16-9~000006_2018",
    "Q16-9~000007_2018",
    "Q16-9~000008_2018",
    "Q16-9~000009_2018",
    "Q16-9~000010_2018")
  return(data)
}

pid <- new_data$C0000100
new_data <- vallabels(new_data)
new_data <- qnames(new_data)
attr(new_data , "variable.labels") <- varlabels
nlsy_full <- new_data
rm(new_data)

nlsy_full$pid <- pid
```

### Race/Ethnicity

#### Simplified Race Variable

```{r NLSY Creating race variable from provided simple race information}
# 
nrace1 <- nlsy_full %>% 
  select(pid, race) %>% 
  mutate(race = factor(race) %>% 
           recode_factor(HISPANIC = "latinx",
                         BLACK = "black",
                         "NON-BLACK, NON-HISPANIC" = "other") %>% 
           forcats::fct_relevel(c("other", "black", "latinx"))
  )
names(nrace1) <- c("pid", "race1")
#table(nrace1$race)
```

#### Complex Race Variable

```{r nlsy race data import and cleaning}
### NLSY Race: They LIED to me and I feel betrayed.

new_data <- read.table(here::here('data/race_identity/race_identity.dat'), sep=' ')

### Handle missing values

  new_data[new_data == -1] = NA  # Refused 
  new_data[new_data == -2] = NA  # Dont know 
  new_data[new_data == -3] = NA  # Invalid missing 
  new_data[new_data == -7] = NA  # Missing 

names(new_data) <- c('C0000100','C0000200','C0005400','C0005700','Y0009800','Y0396800','Y0686600','Y0992300','Y0992301','Y0992302','Y0992303','Y0992304','Y0992305','Y1232900','Y1232901','Y1232902','Y1232903','Y1232904','Y1232905','Y1462700','Y1462701','Y1462702','Y1462703','Y1462704','Y1462705','Y1709900','Y1709901','Y1709902','Y1709903','Y1709904','Y1709905','Y1995500','Y1995501','Y1995502','Y1995503','Y1995504','Y1995505','Y1995506','Y2267000','Y2314300','Y2314301','Y2314302','Y2314303','Y2314304','Y2314305','Y2314306','Y2647000','Y2647001','Y2647002','Y2647003','Y2647004','Y2647005','Y2647006','Y3004200','Y3004201','Y3004202','Y3004203','Y3004204','Y3004205','Y3004206','Y3373000','Y3373001','Y3373002','Y3373003','Y3373004','Y3373005','Y3373006','Y4014100','Y4014101','Y4014102','Y4014103','Y4014104','Y4014105','Y4014106')

vallabels = function(data) {
  data$C0000100[1.0 <= data$C0000100 & data$C0000100 <= 9999999.0] <- 1.0
  data$C0000100 <- factor(data$C0000100, 
    levels=c(1.0), 
    labels=c("1 TO 9999999: See Min & Max values below for range as of this release"))
  data$C0000200[1.0 <= data$C0000200 & data$C0000200 <= 12686.0] <- 1.0
  data$C0000200 <- factor(data$C0000200, 
    levels=c(1.0), 
    labels=c("1 TO 12686: NLSY79 Public ID"))
  data$C0005400 <- factor(data$C0005400, 
    levels=c(1.0,2.0), 
    labels=c("MALE",
      "FEMALE"))
  data$C0005700[1970.0 <= data$C0005700 & data$C0005700 <= 1978.0] <- 1970.0
  data$C0005700 <- factor(data$C0005700, 
    levels=c(1970.0,1979.0,1980.0,1981.0,1982.0,1983.0,1984.0,1985.0,1986.0,1987.0,1988.0,1989.0,1990.0,1991.0,1992.0,1993.0,1994.0,1995.0,1996.0,1997.0,1998.0,1999.0,2000.0,2001.0,2002.0,2003.0,2004.0,2005.0,2006.0,2007.0,2008.0,2009.0,2010.0,2011.0,2012.0,2013.0,2014.0,2015.0,2016.0,2017.0,2018.0,2019.0), 
    labels=c("1970 TO 1978: < before 1979",
      "1979",
      "1980",
      "1981",
      "1982",
      "1983",
      "1984",
      "1985",
      "1986",
      "1987",
      "1988",
      "1989",
      "1990",
      "1991",
      "1992",
      "1993",
      "1994",
      "1995",
      "1996",
      "1997",
      "1998",
      "1999",
      "2000",
      "2001",
      "2002",
      "2003",
      "2004",
      "2005",
      "2006",
      "2007",
      "2008",
      "2009",
      "2010",
      "2011",
      "2012",
      "2013",
      "2014",
      "2015",
      "2016",
      "2017",
      "2018",
      "2019"))
  data$Y0009800 <- factor(data$Y0009800, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0), 
    labels=c("Black",
      "White (non-Hispanic)",
      "Hispanic",
      "American Indian",
      "Asian or Pacific Islander",
      "Other (SPECIFY)"))
  data$Y0396800 <- factor(data$Y0396800, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0), 
    labels=c("Black",
      "White (non-Hispanic)",
      "Hispanic",
      "American Indian",
      "Asian or Pacific Islander",
      "Other (SPECIFY)"))
  data$Y0686600 <- factor(data$Y0686600, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0), 
    labels=c("White",
      "black",
      "indig",
      "Asian",
      "api",
      "Other (SPECIFY)"))
  data$Y0992300 <- factor(data$Y0992300, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "White"))
  data$Y0992301[1.0 <= data$Y0992301 & data$Y0992301 <= 2.0] <- 1.0
  data$Y0992301 <- factor(data$Y0992301, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "black"))
  data$Y0992302[1.0 <= data$Y0992302 & data$Y0992302 <= 3.0] <- 1.0
  data$Y0992302 <- factor(data$Y0992302, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "indig"))
  data$Y0992303[1.0 <= data$Y0992303 & data$Y0992303 <= 4.0] <- 1.0
  data$Y0992303 <- factor(data$Y0992303, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Asian"))
  data$Y0992304[1.0 <= data$Y0992304 & data$Y0992304 <= 5.0] <- 1.0
  data$Y0992304 <- factor(data$Y0992304, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "api"))
  data$Y0992305[1.0 <= data$Y0992305 & data$Y0992305 <= 6.0] <- 1.0
  data$Y0992305 <- factor(data$Y0992305, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Other"))
  data$Y1232900 <- factor(data$Y1232900, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "White"))
  data$Y1232901[1.0 <= data$Y1232901 & data$Y1232901 <= 2.0] <- 1.0
  data$Y1232901 <- factor(data$Y1232901, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "black"))
  data$Y1232902[1.0 <= data$Y1232902 & data$Y1232902 <= 3.0] <- 1.0
  data$Y1232902 <- factor(data$Y1232902, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "indig"))
  data$Y1232903[1.0 <= data$Y1232903 & data$Y1232903 <= 4.0] <- 1.0
  data$Y1232903 <- factor(data$Y1232903, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Asian"))
  data$Y1232904[1.0 <= data$Y1232904 & data$Y1232904 <= 5.0] <- 1.0
  data$Y1232904 <- factor(data$Y1232904, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "api"))
  data$Y1232905[1.0 <= data$Y1232905 & data$Y1232905 <= 6.0] <- 1.0
  data$Y1232905 <- factor(data$Y1232905, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Other"))
  data$Y1462700 <- factor(data$Y1462700, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "White"))
  data$Y1462701[1.0 <= data$Y1462701 & data$Y1462701 <= 2.0] <- 1.0
  data$Y1462701 <- factor(data$Y1462701, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "black"))
  data$Y1462702[1.0 <= data$Y1462702 & data$Y1462702 <= 3.0] <- 1.0
  data$Y1462702 <- factor(data$Y1462702, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "indig"))
  data$Y1462703[1.0 <= data$Y1462703 & data$Y1462703 <= 4.0] <- 1.0
  data$Y1462703 <- factor(data$Y1462703, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Asian"))
  data$Y1462704[1.0 <= data$Y1462704 & data$Y1462704 <= 5.0] <- 1.0
  data$Y1462704 <- factor(data$Y1462704, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "api"))
  data$Y1462705[1.0 <= data$Y1462705 & data$Y1462705 <= 6.0] <- 1.0
  data$Y1462705 <- factor(data$Y1462705, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Other"))
  data$Y1709900 <- factor(data$Y1709900, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "White"))
  data$Y1709901[1.0 <= data$Y1709901 & data$Y1709901 <= 2.0] <- 1.0
  data$Y1709901 <- factor(data$Y1709901, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "black"))
  data$Y1709902[1.0 <= data$Y1709902 & data$Y1709902 <= 3.0] <- 1.0
  data$Y1709902 <- factor(data$Y1709902, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "indig"))
  data$Y1709903[1.0 <= data$Y1709903 & data$Y1709903 <= 4.0] <- 1.0
  data$Y1709903 <- factor(data$Y1709903, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Asian"))
  data$Y1709904[1.0 <= data$Y1709904 & data$Y1709904 <= 5.0] <- 1.0
  data$Y1709904 <- factor(data$Y1709904, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "api"))
  data$Y1709905[1.0 <= data$Y1709905 & data$Y1709905 <= 6.0] <- 1.0
  data$Y1709905 <- factor(data$Y1709905, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Other"))
  data$Y1995500 <- factor(data$Y1995500, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "White"))
  data$Y1995501[1.0 <= data$Y1995501 & data$Y1995501 <= 2.0] <- 1.0
  data$Y1995501 <- factor(data$Y1995501, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "black"))
  data$Y1995502[1.0 <= data$Y1995502 & data$Y1995502 <= 4.0] <- 1.0
  data$Y1995502 <- factor(data$Y1995502, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Asian"))
  data$Y1995503[1.0 <= data$Y1995503 & data$Y1995503 <= 5.0] <- 1.0
  data$Y1995503 <- factor(data$Y1995503, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "api"))
  data$Y1995504[1.0 <= data$Y1995504 & data$Y1995504 <= 3.0] <- 1.0
  data$Y1995504 <- factor(data$Y1995504, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "indig"))
  data$Y1995505[1.0 <= data$Y1995505 & data$Y1995505 <= 6.0] <- 1.0
  data$Y1995505 <- factor(data$Y1995505, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "other"))
  data$Y1995506[1.0 <= data$Y1995506 & data$Y1995506 <= 7.0] <- 1.0
  data$Y1995506 <- factor(data$Y1995506, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "latinx"))
  data$Y2267000 <- factor(data$Y2267000, 
    levels=c(506.0), 
    labels=c("506"))
  data$Y2314300 <- factor(data$Y2314300, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "White"))
  data$Y2314301[1.0 <= data$Y2314301 & data$Y2314301 <= 2.0] <- 1.0
  data$Y2314301 <- factor(data$Y2314301, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "black"))
  data$Y2314302[1.0 <= data$Y2314302 & data$Y2314302 <= 3.0] <- 1.0
  data$Y2314302 <- factor(data$Y2314302, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Asian"))
  data$Y2314303[1.0 <= data$Y2314303 & data$Y2314303 <= 4.0] <- 1.0
  data$Y2314303 <- factor(data$Y2314303, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "api"))
  data$Y2314304[1.0 <= data$Y2314304 & data$Y2314304 <= 5.0] <- 1.0
  data$Y2314304 <- factor(data$Y2314304, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "indig"))
  data$Y2314305[1.0 <= data$Y2314305 & data$Y2314305 <= 6.0] <- 1.0
  data$Y2314305 <- factor(data$Y2314305, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "other"))
  data$Y2314306[1.0 <= data$Y2314306 & data$Y2314306 <= 7.0] <- 1.0
  data$Y2314306 <- factor(data$Y2314306, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "latinx"))
  data$Y2647000 <- factor(data$Y2647000, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "White"))
  data$Y2647001[1.0 <= data$Y2647001 & data$Y2647001 <= 2.0] <- 1.0
  data$Y2647001 <- factor(data$Y2647001, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "black"))
  data$Y2647002[1.0 <= data$Y2647002 & data$Y2647002 <= 3.0] <- 1.0
  data$Y2647002 <- factor(data$Y2647002, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Asian"))
  data$Y2647003[1.0 <= data$Y2647003 & data$Y2647003 <= 4.0] <- 1.0
  data$Y2647003 <- factor(data$Y2647003, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "api"))
  data$Y2647004[1.0 <= data$Y2647004 & data$Y2647004 <= 5.0] <- 1.0
  data$Y2647004 <- factor(data$Y2647004, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "indig"))
  data$Y2647005[1.0 <= data$Y2647005 & data$Y2647005 <= 6.0] <- 1.0
  data$Y2647005 <- factor(data$Y2647005, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "other"))
  data$Y2647006[1.0 <= data$Y2647006 & data$Y2647006 <= 7.0] <- 1.0
  data$Y2647006 <- factor(data$Y2647006, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "latinx"))
  data$Y3004200 <- factor(data$Y3004200, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "White"))
  data$Y3004201[1.0 <= data$Y3004201 & data$Y3004201 <= 2.0] <- 1.0
  data$Y3004201 <- factor(data$Y3004201, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "black"))
  data$Y3004202[1.0 <= data$Y3004202 & data$Y3004202 <= 3.0] <- 1.0
  data$Y3004202 <- factor(data$Y3004202, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Asian"))
  data$Y3004203[1.0 <= data$Y3004203 & data$Y3004203 <= 4.0] <- 1.0
  data$Y3004203 <- factor(data$Y3004203, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "api"))
  data$Y3004204[1.0 <= data$Y3004204 & data$Y3004204 <= 5.0] <- 1.0
  data$Y3004204 <- factor(data$Y3004204, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "indig"))
  data$Y3004205[1.0 <= data$Y3004205 & data$Y3004205 <= 6.0] <- 1.0
  data$Y3004205 <- factor(data$Y3004205, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "other"))
  data$Y3004206[1.0 <= data$Y3004206 & data$Y3004206 <= 7.0] <- 1.0
  data$Y3004206 <- factor(data$Y3004206, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "latinx"))
  data$Y3373000 <- factor(data$Y3373000, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "White"))
  data$Y3373001[1.0 <= data$Y3373001 & data$Y3373001 <= 2.0] <- 1.0
  data$Y3373001 <- factor(data$Y3373001, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "black"))
  data$Y3373002[1.0 <= data$Y3373002 & data$Y3373002 <= 3.0] <- 1.0
  data$Y3373002 <- factor(data$Y3373002, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Asian"))
  data$Y3373003[1.0 <= data$Y3373003 & data$Y3373003 <= 4.0] <- 1.0
  data$Y3373003 <- factor(data$Y3373003, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "api"))
  data$Y3373004[1.0 <= data$Y3373004 & data$Y3373004 <= 5.0] <- 1.0
  data$Y3373004 <- factor(data$Y3373004, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "indig"))
  data$Y3373005[1.0 <= data$Y3373005 & data$Y3373005 <= 6.0] <- 1.0
  data$Y3373005 <- factor(data$Y3373005, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "other"))
  data$Y3373006[1.0 <= data$Y3373006 & data$Y3373006 <= 7.0] <- 1.0
  data$Y3373006 <- factor(data$Y3373006, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "latinx"))
  data$Y4014100 <- factor(data$Y4014100, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "White"))
  data$Y4014101[1.0 <= data$Y4014101 & data$Y4014101 <= 2.0] <- 1.0
  data$Y4014101 <- factor(data$Y4014101, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "black"))
  data$Y4014102[1.0 <= data$Y4014102 & data$Y4014102 <= 3.0] <- 1.0
  data$Y4014102 <- factor(data$Y4014102, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "Asian"))
  data$Y4014103[1.0 <= data$Y4014103 & data$Y4014103 <= 4.0] <- 1.0
  data$Y4014103 <- factor(data$Y4014103, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "api"))
  data$Y4014104[1.0 <= data$Y4014104 & data$Y4014104 <= 5.0] <- 1.0
  data$Y4014104 <- factor(data$Y4014104, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "indig"))
  data$Y4014105[1.0 <= data$Y4014105 & data$Y4014105 <= 6.0] <- 1.0
  data$Y4014105 <- factor(data$Y4014105, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "other"))
  data$Y4014106[1.0 <= data$Y4014106 & data$Y4014106 <= 7.0] <- 1.0
  data$Y4014106 <- factor(data$Y4014106, 
    levels=c(0.0,1.0), 
    labels=c("NA",
      "latinx"))
  return(data)
}
```

```{r Implementing above cleaning functions}
nr <- vallabels(new_data)
names(nr) <- c("pid",
  "ID CODE OF MOTHER OF CHILD",
  "SEX",
  "DATE OF BIRTH",
  "1994",
  "1996",
  "1998",
  "WHITE 2000",
  "BLACK OR AFRICAN AMER 2000",
  "AM INDIAN OR ALASKA NAT 2000",
  "ASIAN 2000",
  "NAT HAWAIIAN, OTH PAC IS 2000",
  "OTHER RACE (SPECIFY) 2000",
  "WHITE 2002",
  "BLACK OR AFRICAN AMER 2002",
  "AM INDIAN OR ALASKA NAT 2002",
  "ASIAN 2002",
  "NAT HAWAIIAN, OTH PAC IS 2002",
  "OTHER RACE (SPECIFY) 2002",
  "WHITE 2004",
  "BLACK OR AFRICAN AMER 2004",
  "AM INDIAN OR ALASKA NAT 2004",
  "ASIAN 2004",
  "NAT HAWAIIAN, OTH PAC IS 2004",
  "OTHER RACE (SPECIFY) 2004",
  "WHITE 2006",
  "BLACK OR AFRICAN AMER 2006",
  "AM INDIAN OR ALASKA NAT 2006",
  "ASIAN 2006",
  "NAT HAWAIIAN, OTH PAC IS 2006",
  "OTHER RACE (SPECIFY) 2006",
  "WHITE 2008",
  "BLACK OR AFRICAN AMER 2008",
  "ASIAN 2008",
  "NAT HAWAIIAN, OTH PAC IS 2008",
  "AM INDIAN OR ALASKA NAT 2008",
  "OTHER RACE (SPECIFY) 2008",
  "HISPANIC/LATINO 2008",
  "VERSION_R28 CHILD/YOUNG ADULT XRND",
  "WHITE 2010",
  "BLACK OR AFRICAN AMER 2010",
  "ASIAN 2010",
  "NAT HAWAIIAN, OTH PAC IS 2010",
  "AM INDIAN OR ALASKA NAT 2010",
  "OTHER RACE (SPECIFY) 2010",
  "HISPANIC/LATINO 2010",
  "WHITE 2012",
  "BLACK OR AFRICAN AMER 2012",
  "ASIAN 2012",
  "NAT HAWAIIAN, OTH PAC IS 2012",
  "AM INDIAN OR ALASKA NAT 2012",
  "OTHER RACE (SPECIFY) 2012",
  "HISPANIC/LATINO 2012",
  "WHITE 2014",
  "BLACK OR AFRICAN AMER 2014",
  "ASIAN 2014",
  "NAT HAWAIIAN, OTH PAC IS 2014",
  "AM INDIAN OR ALASKA NAT 2014",
  "OTHER RACE (SPECIFY) 2014",
  "HISPANIC/LATINO 2014",
  "WHITE 2016",
  "BLACK OR AFRICAN AMER 2016",
  "ASIAN 2016",
  "NAT HAWAIIAN, OTH PAC IS 2016",
  "AM INDIAN OR ALASKA NAT 2016",
  "OTHER RACE (SPECIFY) 2016",
  "HISPANIC/LATINO 2016",
  "WHITE 2018",
  "BLACK OR AFRICAN AMER 2018",
  "ASIAN 2018",
  "NAT HAWAIIAN, OTH PAC IS 2018",
  "AM INDIAN OR ALASKA NAT 2018",
  "OTHER RACE (SPECIFY) 2018",
  "HISPANIC/LATINO 2018"
)
nr <- nr %>% 
  janitor::clean_names()
```

```{r}
nlsy_race <- nr[,c(8:38, 40:74)] # Removing unnecessary columns
#
colnames(nlsy_race) <- as.character(1:66)

nlsy_race <- nlsy_race %>% 
  unite("all", "1":"66", na.rm = T)

ncr <- gsub('_', '', nlsy_race$all) 

ncr <- gsub('NA', '', ncr) %>% 
  tolower()


#I've not got these racial markers. We should discuss what to do with them.
n <- fct_collapse(ncr,
                   white = c("white", "whiteother", "whitewhite"),
                   black = c("blackblack", "black", "blackasian", "blacklatinx",
                             "blackother", "blackapi", "blackindig", 
                             "blackindigother", "whiteblack", "whiteblackindig", "whiteblackindigasian", 
                             "whiteblackother", "blackindiglatinx", "whiteblackasian","whiteblackindigother"),
                   latinx = c("latinx", "latinxlatinx", "otherlatinx", "whitelatinx", 
                              "whiteotherlatinx", "apilatinx", "whiteindiglatinx" ),
                   aapi = c("asian", "asianother", "api", "apiother", "whiteasian", 
                            "whiteapi","whiteapiother", "asianapi"),
                   indig = c("indig","indigother", "whiteindig", "whiteindigother"),
                   other = c("other", "otherother", "whiteasianindig")
)

### 94-98 were a different scale

r1994 <- factor(new_data$Y0009800, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0), 
    labels=c("black",
      "white",
      "latinx",
      "indig",
      "aapi",
      "other"))
r1996 <- factor(new_data$Y0396800, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0), 
    labels=c("black",
      "white",
      "latinx",
      "indig",
      "aapi",
      "other"))
r1998 <- factor(new_data$Y0686600, 
    levels=c(1.0,2.0,3.0,4.0,5.0,6.0), 
    labels=c("white",
      "black",
      "indig",
      "Asian",
      "aapi",
      "other"))
  
r <- tibble(n, r1994, r1996, r1998)
r <- r %>% 
  unite("all", n:r1998)
r$all <- gsub('NA', '', r$all)
r$all <- gsub('_', '', r$all) 
r$all <- gsub(' ', '', r$all)
x <- factor(r$all) %>% 
  fct_collapse(.,
                   white = c("white", "whitewhiteother", "otherwhite", 
                             "whiteother", "whitewhite", "whitewhitewhite"),
                   black = c("black", "blackblack", "blackother", "blackwhite", 
                             "indigblack", "otherblack", "latinxblack", "whiteblack", 
                             "whitewhiteblack", "aapiblack"),
                   latinx = c("latinx", "latinxlatinx", "otherlatinx", "latinxindig", 
                              "whitelatinx", "indiglatinx", "otherlatinx", 
                              "latinxwhite", "latinxother"),
                   aapi = c("aapi","aapiaapi","aapiother", "otherAsian", "aapiwhite", "Asian"),
                   indig = c("indig", "otherindig", "whiteindig", "indigindig", "indigwhite"),
                   other = c("other", "otherother")) %>% 
  as.character(.) %>% 
  gsub(' ', '', .) %>% 
  factor()
nlsy_race <- tibble(new_data[,1], x)
colnames(nlsy_race) <- c("pid", "race_full")
nlsy_full <- left_join(nlsy_full, nlsy_race)
```

> We're removing all participants born after 1996, because they don't have the full 18 years of data for schooling, as the final suspension year information was collectd is 2014

```{r Filtering <18 year olds}
# Removing participants who aren't 18 at most recent data collection level
nlsy <- nlsy_full %>%
   filter(!as.integer(nlsy_full$year) %in% c(18:41)) #factor levels for birth year > 1994
#nlsy$pid <- 1:nrow(nlsy)
``` 

### Personality Measures

```{r NLSY TIPI, cache=TRUE, warning = FALSE}
# Selecting TIPI scores
nlsy_loop <- nlsy %>% 
  select('Q16-9~000001_2006':'Q16-9~000010_2008', 
         "Q16-9~000001_2010":"Q16-9~000010_2010", 
         "Q16-9~000001_2012":"Q16-9~000010_2012", 
         "Q16-9~000001_2014":"Q16-9~000010_2014",  
         "Q16-9~000001_2016":"Q16-9~000010_2018")

# Creating empty matrix to load TIPI scores
first_nlsy_tipi <- matrix(NA, nrow(nlsy), 10) %>% 
  as_tibble()
year_tipi <- rep(NA, nrow(first_nlsy_tipi))

# Loop to find first full TIPI score
tipi_sections <- seq(from = 1, to = 70, by = 10)

for (j in 1:nrow(nlsy_loop)) {
  for (i in tipi_sections) {
  if (complete.cases(nlsy_loop[j,i:(i+9)]) == FALSE) { 
    next
    } else {
    first_nlsy_tipi[j, 1:10] <- nlsy_loop[j,i:(i+9)]
    year_tipi[j] <- i
    break
  }
  }
  }

# Loop to create numeric variables
tipi <- matrix(NA, nrow(first_nlsy_tipi), ncol(first_nlsy_tipi))
for (i in (1:nrow(first_nlsy_tipi))) {
  for (j in (1:ncol(first_nlsy_tipi))) {
    tipi[i,j] <- str_sub(first_nlsy_tipi[i,j], start = 1, end = 1) %>% 
      as.numeric()
  }
}
# NOTE: The above loop creates warnings for str_sub() on empty cells. It is fine :-)

tipi <- as_tibble(tipi)
colnames(tipi) <- c("extra1", "agree1", "consc1", "neuro1", "open1",
                         "extra2", "agree2", "consc2", "neuro2", "open2")

tipi_items <- c("extra1", "agree1", "consc1", "neuro1", "open1",
                         "extra2", "agree2", "consc2", "neuro2", "open2")
tipi_questions <- c("EXTRAVERTED, ENTHUSIASTIC",
"CRITICAL, QUARRLESOME",
"DEPENDABLE, SELF-DISCIPLINED",
"ANXIOUS, EASILY UPSET",
"OPEN TO NEW EXPERIENCES, COMPLEX",
"RESERVED, QUIET",
"SYMPATHETIC, WARM",
"DISORGANIZED, CARELESS",
"CALM, EMOTIONALLY STABLE",
"CONVENTIONAL, UNCREATIVE")
NLSY_TIPI_QUESTIONS <- tibble(tipi_items, tipi_questions)

# Creating reverse coded keys 
keys <- c(1, -1, 1, -1, 1, -1, 1, -1, 1, -1)
tipi_r <- reverse.code(keys, tipi) %>% 
  as_tibble()

nlsy_tipi_items <- tipi_r %>% 
  select(starts_with("e"), starts_with("a"), starts_with("c"), starts_with("n"), starts_with("o"))

tipi_rev <- tipi_r %>% 
  select(ends_with("-"), everything()) %>% 
  cor(nlsy_tipi_items, use = "pairwise") %>% 
  round(2)

NLYS_TIPI_CORRELATIONS <- cor(nlsy_tipi_items, use = "pairwise") %>% 
  round(2) %>%
  knitr::kable()

tipi_r$extra_tipi <- (tipi_r$extra1 + tipi_r$`extra2-`)/2
tipi_r$agree_tipi <- (tipi_r$`agree1-` + tipi_r$agree2)/2
tipi_r$consc_tipi <- (tipi_r$consc1 + tipi_r$`consc2-`)/2
tipi_r$neuro_tipi <- (tipi_r$`neuro1-` + tipi_r$neuro2)/2
tipi_r$open_tipi <- (tipi_r$open1 + tipi_r$`open2-`)/2
tipi_r$pid <- nlsy$pid
nlsy <- left_join(nlsy, tipi_r, by = "pid")

```

```{r NLSY TIPI Correlations}
get_upper_tri <- function(cormat){
    cormat[lower.tri(cormat)]<- NA
    return(cormat)
  }
  
upper_tri <- get_upper_tri(tipi_rev)
upper_tri

library(reshape2)
melted_cormat <- melt(upper_tri)
library(ggplot2)
ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()

```

```{r NLSY Mini-IPIP}
mini_ipip <- nlsy %>% 
  select(`Q16-9A~000001_2012`:`Q16-9A~000020_2012`) %>% 
  as_tibble()

# FUNCTION FOR RECODING TO NUMERIC
mini_ipip_code <- function(data){
  factor(data, levels = c("Very Inaccurate","Moderately Inaccurate",
             "Neither Accurate Nor Inaccurate", 
             "Moderately Accurate","Very Accurate"),
  labels = c("1","2","3","4","5")) %>% 
    as.numeric(data)
}

cols <- names(mini_ipip)
mini_ipip[cols] <- lapply(mini_ipip[cols], mini_ipip_code)

psych::describe(mini_ipip)

# Key for reverse coding
keys <- c(1,1,1,-1,1,
          -1,-1,-1,1,-1,
          1,1,1,-1,-1,
           -1,-1,-1,1,-1)

# REVERSE CODING
mini_ipip_r <- psych::reverse.code(keys, mini_ipip) %>% 
  as.matrix(ncol = 32) %>% 
  as_tibble()

# keeping names the same (without '-' coerced in reverse.code())
names(mini_ipip_r) <- c("EXTRAV1", "AGREE1", "CONSC1", "NEURO1", "OPEN1", 
                        "EXTRAV2", "AGREE2", "CONSC2", "NEURO2", "OPEN2",
                        "EXTRAV3", "AGREE3", "CONSC3", "NEURO3", "OPEN3",
                        "EXTRAV4", "AGREE4", "CONSC4", "NEURO4", "OPEN4"
                        )

extrav_mi = mini_ipip_r %>% 
  select(starts_with("EXTRAV")) %>% 
  rowMeans(na.rm=T)

agree_mi = mini_ipip_r %>% 
  select(starts_with("AGREE")) %>%  
  rowMeans(na.rm=T)

consc_mi = mini_ipip_r %>% 
  select(starts_with("CONSC")) %>%  
  rowMeans(na.rm=T)

neuro_mi = mini_ipip_r %>% 
  select(starts_with("NEURO")) %>% 
  rowMeans(na.rm=T)

open_mi = mini_ipip_r %>% 
  select(starts_with("OPEN")) %>% 
  rowMeans(na.rm=T)
pid = nlsy$pid

mip_nlsy <- tibble(pid, extrav_mi, open_mi, consc_mi, neuro_mi, agree_mi)

#### Table for reviewing item-level issues:
nlsy_mini_ipip_items <- mini_ipip_r %>% 
  select(starts_with("EXTRAV"), starts_with("AGREE"), starts_with("CONSC"), starts_with("NEURO"), starts_with("OPEN"))

NLYS_MINI_IPIP_CORRELATIONS <- cor(nlsy_mini_ipip_items, use = "pairwise") %>% 
  round(., 2)

nlsy_mini_ipip_items$pid <- nlsy$pid

nlsy_mini_ipip <- full_join(mip_nlsy, nlsy_mini_ipip_items, by = "pid")

psych::describe(nlsy_mini_ipip_items)



items <- c("EXTRAV1", "AGREE1", "CONSC1", "NEURO1", "OPEN1", 
                        "EXTRAV2", "AGREE2", "CONSC2", "NEURO2", "OPEN2",
                        "EXTRAV3", "AGREE3", "CONSC3", "NEURO3", "OPEN3",
                        "EXTRAV4", "AGREE4", "CONSC4", "NEURO4", "OPEN4"
                        )
questions <- c("I AM THE LIFE OF THE PARTY","I SYMPATHIZE WITH OTHERS' FEELINGS","I GET CHORES DONE RIGHT AWAY","I HAVE FREQUENT MOOD SWINGS","I HAVE A VIVID IMAGINATION","I DON'T TALK A LOT","I AM NOT INTERESTED IN OTHER PEOPLE'S PROBLEMS","I OFTEN FORGET TO PUT THINGS BACK IN THEIR PROPER PLACE","I AM RELAXED MOST OF THE TIME","I AM NOT INTERESTED IN ABSTRACT IDEAS","I TALK TO A LOT OF DIFFERENT PEOPLE AT PARTIES","I FEEL OTHERS' EMOTIONS","I LIKE ORDER","I GET UPSET EASILY","I HAVE DIFFICULTY UNDERSTANDING ABSTRACT IDEAS","I KEEP IN THE BACKGROUND","I AM NOT REALLY INTERESTED IN OTHERS","I MAKE A MESS OF THINGS","I SELDOM FEEL BLUE","I DO NOT HAVE A GOOD IMAGINATION)")

NLSY_MINI_IPIP_QUESTIONS <- tibble(items, questions)
```

Mini-IPIP Items:
I AM THE LIFE OF THE PARTY
I SYMPATHIZE WITH OTHERS' FEELINGS
I GET CHORES DONE RIGHT AWAY
I HAVE FREQUENT MOOD SWINGS
I HAVE A VIVID IMAGINATION
I DON'T TALK A LOT
I AM NOT INTERESTED IN OTHER PEOPLE'S PROBLEMS
I OFTEN FORGET TO PUT THINGS BACK IN THEIR PROPER PLACE
I AM RELAXED MOST OF THE TIME
I AM NOT INTERESTED IN ABSTRACT IDEAS
I TALK TO A LOT OF DIFFERENT PEOPLE AT PARTIES
I FEEL OTHERS' EMOTIONS
I LIKE ORDER
I GET UPSET EASILY
I HAVE DIFFICULTY UNDERSTANDING ABSTRACT IDEAS
I KEEP IN THE BACKGROUND
I AM NOT REALLY INTERESTED IN OTHERS
I MAKE A MESS OF THINGS
I SELDOM FEEL BLUE
I DO NOT HAVE A GOOD IMAGINATION


```{r NLSY TIPI & MINI-IPIP correlations}
nlsy_personality <- left_join(tipi_r, nlsy_mini_ipip, by = "pid") %>% 
  select("pid", sort(colnames(.)))
NLSY_PERSONALITY_CORMAT_FULL <- cor(nlsy_personality, use = "pairwise") %>% 
  round(2)
NLSY_PERSONALITY_COR <- nlsy_personality %>% 
  select(agree_mi, agree_tipi, extra_tipi, extrav_mi, open_mi, open_tipi, consc_mi, consc_tipi, neuro_mi, neuro_tipi) %>% 
  cor(., use = "pairwise") %>% 
  round(2)
```

> Capitalized variables are Mini-IPIP, lowercase are TIPI
We're seeing the same problems here, the reverse-coded items are massively impacting the correlations between scales. Composite score correlations range from .20 (agreeableness) to 0.45 (extraversion)

### Age

```{r NLSY Age}
# Creating variable for year when participants completed their first full TIPI
nlsy$year_tipi <- (year_tipi - 1) / 5 + 2006

nlsy <- nlsy %>% 
  mutate(
    birth_year = as.character(year)
  )

nlsy$birth_year <- str_sub(nlsy$birth_year, start = 1, end = 4) %>% 
  as.numeric()
nlsy$age_tipi <- nlsy$year_tipi - nlsy$birth_year
nlsy <- subset(nlsy, select = -c(month, year))
```

### Suspension

```{r NLSY Suspension}
nlsy_ever1 <-  nlsy[ , grepl( "ever" , names( nlsy ) ) ]
nlsy_ever <- unlist(nlsy_ever1) %>% 
  tolower()
nlsy_ever <- gsub("no", 0, nlsy_ever)
nlsy_ever <- gsub("yes", 1, nlsy_ever)
nlsy_ever <- nlsy_ever %>% 
  as.numeric() %>% 
  matrix(ncol = 14) %>% 
  as_tibble()
nlsy_ever[is.na(nlsy_ever)] <- 0
ever_suspended <- apply(nlsy_ever, 1, max, na.rm = T) %>% 
  as.numeric()
  
nlsy$ever_suspended <- factor(ever_suspended,
                              levels = c(0,1),
                              labels = c("No", "Yes"))
```

### Joining Data Frames

```{r NLSY Joining into Data Frame}
nlsy <- left_join(nlsy, nlsy_mini_ipip, by = "pid")
nlsy <- left_join(nlsy, nrace1, by = "pid") 
nlsy <- nlsy %>% 
  select(pid, race1, race_full, sex, birth_year, age_tipi, ever_suspended, extra_tipi, agree_tipi, consc_tipi, open_tipi, neuro_tipi, extrav_mi, agree_mi, consc_mi, open_mi, neuro_mi, ever_1988:grade_2014)
```

### Final Glimpse

```{r}
finalfit::ff_glimpse(nlsy)
```

## ADD Health Data Preparation

### Import and basic cleaning

```{r ADD Import, cache = TRUE, results='hide', message=FALSE}
# Import each of the sub-files in the ADD Health dataset
add_1 <- rio::import(here::here("data/ICPSR_21600/DS0001/21600-0001-Data.rda"))
add_5 <- rio::import(here::here("data/ICPSR_21600/DS0005/21600-0005-Data.rda"))
add_8 <- rio::import(here::here("data/ICPSR_21600/DS0008/21600-0008-Data.rda"))
add_16 <- rio::import(here::here("data/ICPSR_21600/DS0016/21600-0016-Data.rda"))
add_22 <- rio::import(here::here("data/ICPSR_21600/DS0022/21600-0022-Data.rda"))

#COMBINING VARIABLES
add_full <- full_join(add_1, add_5, by = "AID")
add_full <- full_join(add_full, add_8, by = "AID")
add_full <- full_join(add_full, add_16, by = "AID")
add_full <- full_join(add_full, add_22, by = "AID")

add_full <- sjlabelled::remove_all_labels(add_full)
```

```{r ADD Colnames and Factor Labels}
# CREATING NEW DATA FRAME OF JUST VARIABLES OF INTEREST 
add <- select(add_full, 
              #DEMOGRAPHICS
              AID, BIO_SEX, H1GI1M, H1GI1Y, H1GI9, H1GI4, 
              H1GI10, H1GI11, H1GI20,
              # SUSPENSION
              H2ED3, H1ED7, H1ED8, 
              # PERSONALITY
              H4PE1, H4PE2, H4PE3, H4PE4, H4PE5, H4PE6, H4PE7, 
              H4PE8, H4PE9, H4PE10, H4PE11, H4PE12, H4PE13, 
              H4PE14, H4PE15, H4PE16, H4PE17, H4PE18, H4PE19, 
              H4PE20, H4PE21, H4PE22, H4PE23, H4PE24, H4PE25, H4PE26, 
              H4PE27, H4PE28, H4PE29, H4PE30, H4PE31, H4PE32) 

add_names <- c("pid", "sex", "month", "birth_year", "race", 
           "hispanic", "home_language", "US_born", "grade_w1", 
           "suspension_this_year", "ever_suspended", "grade_last_suspended",
           "EXTRAV1", "AGREE1", "CONSC1", "NEURO1", 
           "OPEN1", "ANXIETY1", "OPTIMISM1", "ANGER1", 
           "EXTRAV2", "AGREE2", "CONSC2", "NEURO2", 
           "OPEN2", "ANXIETY2", "OPTIMISM2", "ANGER2",
           "EXTRAV3", "AGREE3", "CONSC3", "NEURO3", 
           "OPEN3", "ANXIETY3", "OPTIMISM3", "ANGER3",
           "EXTRAV4", "AGREE4", "CONSC4", "NEURO4", 
           "OPEN4", "ANXIETY4", "OPTIMISM4", "ANGER4")
names(add) <- add_names

# Creating subgroups for cleaning
add_mini_ipip <- add %>% 
  select(EXTRAV1:ANGER4)

add_demographics <- add %>% 
  mutate(., 
         sex = factor(sex, 
                          levels = c("(1) (1) Male",
                                     "(2) (2) Female"), 
                          labels = c("male", "female")),
         race = factor(race,
                       levels = c("(1) (1) White",
                                  "(2) (2) Black/African American",
                                  "(3) (3) American Indian/Native American",
                                  "(4) (4) Asian/Pacific Islander",
                                  "(5) (5) Other" ),
                       labels = c("White", "Black", "Indigenous/Native American", 
                                  "Asian/Pacific Islander", "Other")),
         hispanic = factor(hispanic,
                           levels = c("(0) (0) No",
                                      "(1) (1) Yes"),
                           labels = c("no", "yes")),
         home_language = factor(home_language,
                                levels = c("(1) (1) English",
                                           "(2) (2) Spanish",
                                           "(3) (3) Other"),
                                labels = c("English", "Spanish", "Other")),
         US_born = factor(US_born,
                          levels = c("(0) (0) No",
                                     "(1) (1) Yes (skip to Q.15)"),
                          labels = c("no", "yes")),
         grade_w1 = factor(grade_w1, 
                           levels = c("(07) (7) 7th grade",
                                      "(08) (8) 8th grade",
                                      "(09) (9) 9th grade",
                                      "(10) (10) 10th grade",
                                      "(11) (11) 11th grade",
                                      "(12) (12) 12th grade"),
                           labels = c(7, 8, 9, 10, 11, 12)),
         suspension_this_year = factor(suspension_this_year,
                          levels = c("(0) (0) No",
                                     "(1) (1) Yes"),
                          labels = c("no", "yes")),
         ever_suspended = factor(ever_suspended,
                          levels = c("(0) (0) No (skip to Q.9)",
                                     "(1) (1) Yes"),
                          labels = c("no", "yes")),
         grade_last_suspended = factor(grade_last_suspended,
                                       levels = c("(01) (1) 1st", 
                                                  "(02) (2) 2nd",
                                                  "(03) (3) 3rd",
                                                  "(04) (4) 4th", 
                                                  "(05) (5) 5th",
                                                  "(06) (6) 6th",
                                                  "(07) (7) 7th",
                                                  "(08) (8) 8th",
                                                  "(09) (9) 9th", 
                                                  "(10) (10) 10th",
                                                  "(11) (11) 11th", 
                                                  "(12) (12) 12th"),
                                       labels = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12))
         )

# REPLACING CHARACTERS MONTH/YEAR
add_demographics$birth_year <- str_sub(add_demographics$birth_year, start = 2, end = 3) %>% 
      as.numeric()
# REORDERING COLUMNS
add <- add_demographics %>% 
  select(pid, sex, birth_year, race, hispanic, home_language, US_born, 
         grade_w1, suspension_this_year, ever_suspended, grade_last_suspended)
``` 

### Personality (Mini-IPIP)

I AM THE LIFE OF THE PARTY
I SYMPATHIZE WITH OTHERS' FEELINGS
I GET CHORES DONE RIGHT AWAY
I HAVE FREQUENT MOOD SWINGS
I HAVE A VIVID IMAGINATION
 I worry about things
 I'm always optimistic about my future
 I get angry easily
I DON'T TALK A LOT
I AM NOT INTERESTED IN OTHER PEOPLE'S PROBLEMS
I OFTEN FORGET TO PUT THINGS BACK IN THEIR PROPER PLACE
I AM RELAXED MOST OF THE TIME
I AM NOT INTERESTED IN ABSTRACT IDEAS
 I am not easily bothered by things
 I hardly ever expect things to go my way
 I rarely get irritated
I TALK TO A LOT OF DIFFERENT PEOPLE AT PARTIES
I FEEL OTHERS' EMOTIONS
I LIKE ORDER
I GET UPSET EASILY
I HAVE DIFFICULTY UNDERSTANDING ABSTRACT IDEAS
I get stressed out easily
Overall, I expect more good things to happen to me than bad
I lose my temper
I KEEP IN THE BACKGROUND
I AM NOT REALLY INTERESTED IN OTHERS
I MAKE A MESS OF THINGS
I SELDOM FEEL BLUE
I DO NOT HAVE A GOOD IMAGINATION
I don't worry about things that have already happened
I rarely count on good things happening to me
I keep my cool

```{r ADD Mini-IPIP, warning = FALSE}
for (i in 1:ncol(add_mini_ipip)) {
    add_mini_ipip[,i] <- str_sub(add_mini_ipip[,i], start = 2, end = 2) %>% 
      as.numeric()
}

cols <- names(add_mini_ipip)

keys <- c(1,1,1,-1,1,-1,1,-1,
          -1,-1,-1,1,-1,1,-1,1,
          1,1,1,-1,-1,-1,1,-1,
           -1,-1,-1,1,-1,1,-1,1)

########## KEYS SOLVED

keys <- keys*-1

# REVERSE CODING
mini_ipip_r <- psych::reverse.code(keys, add_mini_ipip) %>% 
  as.matrix(ncol = 32) %>% 
  as_tibble()

AMICOR_Rev <- mini_ipip_r %>% 
  select(ends_with("-"), everything())%>% 
  cor(., use = "pairwise") %>% 
  round(., 2)

ADD_MINI_IPIP_COR <- mini_ipip_r %>% 
  select(starts_with("EXTRA"), starts_with("AGREE"), starts_with("CONSC"), starts_with("NEURO"), starts_with("OPEN"), starts_with("ANX"), starts_with("OPTIM"), starts_with("ANGER")) %>% 
  cor(., use = "pairwise") %>% 
  round(., 2)
# keeping names the same (without '-' coerced in reverse.code())
names(mini_ipip_r) <- cols

ami_items <- c("I AM THE LIFE OF THE PARTY","I SYMPATHIZE WITH OTHERS' FEELINGS","I GET CHORES DONE RIGHT AWAY","I HAVE FREQUENT MOOD SWINGS","I HAVE A VIVID IMAGINATION"," I worry about things"," I'm always optimistic about my future"," I get angry easily","I DON'T TALK A LOT","I AM NOT INTERESTED IN OTHER PEOPLE'S PROBLEMS","I OFTEN FORGET TO PUT THINGS BACK IN THEIR PROPER PLACE","I AM RELAXED MOST OF THE TIME","I AM NOT INTERESTED IN ABSTRACT IDEAS"," I am not easily bothered by things"," I hardly ever expect things to go my way"," I rarely get irritated","I TALK TO A LOT OF DIFFERENT PEOPLE AT PARTIES","I FEEL OTHERS' EMOTIONS","I LIKE ORDER","I GET UPSET EASILY","I HAVE DIFFICULTY UNDERSTANDING ABSTRACT IDEAS","I get stressed out easily","Overall, I expect more good things to happen to me than bad","I lose my temper","I KEEP IN THE BACKGROUND","I AM NOT REALLY INTERESTED IN OTHERS","I MAKE A MESS OF THINGS","I SELDOM FEEL BLUE","I DO NOT HAVE A GOOD IMAGINATION","I don't worry about things that have already happened","I rarely count on good things happening to me","I keep my cool")

add_mini_ipip_questions <- tibble(cols, ami_items, keys)

# CREATING SUM MINI-IPIP SCORES PER SCORING INSTRUCTIONS
extrav <- mini_ipip_r %>% 
  select(starts_with("EXTRAV")) %>% 
  rowMeans(na.rm=T)

agree = mini_ipip_r %>% 
  select(starts_with("AGREE")) %>%  
  rowMeans(na.rm=T)

consc = mini_ipip_r %>% 
  select(starts_with("CONSC")) %>%  
  rowMeans(na.rm=T)

neuro = mini_ipip_r %>% 
  select(starts_with("NEURO")) %>% 
  rowMeans(na.rm=T)

open = mini_ipip_r %>% 
  select(starts_with("OPEN")) %>% 
  rowMeans(na.rm=T)

anger = mini_ipip_r %>% 
  select(starts_with("ANGER")) %>%  
  rowMeans(na.rm=T)

optimism = mini_ipip_r %>% 
  select(starts_with("OPTIM")) %>% 
  rowMeans(na.rm=T)

anxiety = mini_ipip_r %>% 
  select(starts_with("ANXIE")) %>% 
  rowMeans(na.rm=T)

pid = add$pid

mip_clean <- tibble(pid, extrav, agree, consc, neuro, open, anger, optimism, anxiety)

ADD_MINI_IPIP_SCORES <- tibble(extrav, agree, consc, neuro, open, anger, optimism, anxiety)
```

> Solved the Keys problem! Their coding for Likert scales was reverse what they said it was.


```{r ADD MINI-IPIP Correlations}
mini_ipip_r <- mini_ipip_r %>% 
  select(starts_with("ex"), starts_with("ag"), starts_with("co"), starts_with("ne"), starts_with("ope"), starts_with("anx"), starts_with("opt"), starts_with("ang"))

ADD_MINI_IPIP_CORS <- cor(mini_ipip_r, use = "pairwise") %>% 
  round(., 2) %>% 
  psych::mat.sort()

get_upper_tri <- function(cormat){
    cormat[lower.tri(cormat)]<- NA
    return(cormat)
  }
  
upper_tri <- get_upper_tri(AMICOR_Rev)
upper_tri

library(reshape2)
melted_cormat <- melt(upper_tri)
library(ggplot2)
ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()

```

### Cleaning Function 

```{r ADD cleaning, warning=FALSE}
add <- left_join(add, mip_clean, by = "pid")

# Save complete dataframes

add_cleaned <- add 

# Use function to filter cases that are incomplete for our analyses

add <- completeFun(add, c("race", "sex", "birth_year", "extrav", "agree", "neuro", "consc", "open", "ever_suspended"))
```

### Race/Ethnicity

```{r ADD Race}
# THIS GOT MESSY BECAUSE OF SOME REDUNDANCY IN THE LEVELLING OF FACTORS

race_simple <- rep(NA, nrow(add))

for (i in 1:nrow(add)) {
  if (add$race[i] == "Black"){
    race_simple[i] <- "BLACK" 
  }else {
      race_simple[i] <- "NON-BLACK, NON-HISPANIC"
    }
}

race <- paste0(add$race, add$hispanic)  %>% 
  factor()
levels(race)
race <- forcats::fct_collapse(race,
                      black = c("Blackno", "BlackNA"),
                      latinx = c("Asian/Pacific Islanderyes","Indigenous/Native Americanyes", "Otheryes", "Whiteyes", "Blackyes"),
                      white = c("WhiteNA", "Whiteno"),
                      other = c("Asian/Pacific IslanderNA","Asian/Pacific Islanderno", "Indigenous/Native Americanno" ,"NANA" ,                         "NAno","OtherNA","Otherno"))

add$race<- race

add$race <- add$race %>% 
  forcats::fct_relevel(c("black", "white", "latinx", "other"))
```

### Final Glimpse

```{r}
finalfit::ff_glimpse(add)
```

## Final Cleaning 

### Cleaning Global Environment

```{r Cleaning Global Environment}
rm(add_1, add_16, add_22, add_5, add_8, add_cleaned, add_demographics, add_full, first_nlsy_tipi, mini_ipip, mini_ipip_r, mip_clean, mip_nlsy, nlsy_ever, nlsy_full, nlsy_long2, nlsy_loop, tipi, tipi_r, upper_tri)
```

### Complete Cases

```{r Complete Cases Function applied to data}
nlsy <- completeFun(nlsy, c("race_full", "sex", "extra_tipi", "agree_tipi", "consc_tipi", "neuro_tipi", "open_tipi", "age_tipi", "ever_suspended"))

add <- completeFun(add, c("race", "sex", "birth_year", "extrav", "agree", "neuro", "consc", "open", "ever_suspended")) 

```

```{r final race variables}
nlsy$race2 <- nlsy$race_full %>% 
  fct_collapse(
    other = c("", "aapi", "indig", "other")
  ) %>% 
  forcats::fct_relevel(c("black", "white", "latinx", "other"))
levels(nlsy$race2)
add$race %>% 
  levels()
```

# Adding in additional variables 4/28/2022

## ADD Health

```{r}
# DS1
ds1_grades <- c(
  "H1ED11", # ENGLISH
  "H1ED12", # MATH
  "H1ED13", # HISTORY
  "H1ED14", # SCIENCE
  "S10A", # ENGLISH
  "S10B", # MATH
  "S10C", # HISTORY
  "S10D", # SCICNCE
)
# DS5
ds5_grades <- c(
  "H2ED7",  # ENGLISH
  "H2ED8", # MATH
  "H2ED9", # HISTORY
  "H2ED10", # SCIENCE
)

add_diploma <- c(
  "H3ED3", #HAS RECEIVED DIPLOMA
  "H3ED9",  #HAS NOT RECEIVED DIPLOMA
  "H4ED1" # Wave 4 hs graduation status
)

add_delq <- c(
  "H2DS1",
  "H2DS2",
  "H2DS3",
  "H2DS4",
  "H2DS5",
  "H2DS6",
  "H2DS7",
  "H2DS8",
  "H2DS9",
  "H2DS10",
  "H2DS11",
  "H2DS12",
  "H2DS13",
  "H2DS14"
)

# Scale developed by Bruefach & Reynolds https://www.sciencedirect.com/science/article/pii/S0049089X21001447?via%3Dihub#fn1
add_perceived_isolation_scale <- c(
  ### From Bruefach & Reynolds' Scale
  "S62E",    #I feel like I am part of this school
  "H1ED19", #I feel close to people at this school
  "S62I", #I am happy to be at this school
  "H1FS17", #You felt that people disliked you
  "H1FS14", # People were unfriendly to you
  "H1FS13", # You felt lonely
  ### Misc variables
  "H1DA7" # During the past week, how many times did you just hang out with friends?
)

```

```{r}

```


> ADD HEALTH Notes: School-level teacher & classroom race data are behind a paywall

## NLSY

```{r}
nlsy_diploma <- c(
  "HGC_DLI", # Highest grade completed as of date of last interview.
  "HSTDEGREE2018"  # Highest academic degree received as of the 2018 interview.
)

nlsy_school <- c(
  # It's easy to make friends at this school.
  "CS884143", 
  "CS906463", 
  "CS926611", 
  "CS942243", 
  "CS960613", 
  "CS98023A",	
  "CSAS023A",
  # Most of the teachers are willing to help with personal problems.
  "CS884144", 
  "CS906465", 
  "CS926613", 
  "CS942245", 
  "CS960615", 
  "CS98023B",	
  "CSAS023B",
  # Most of my classes are boring.
  "CS884145", 
  "CS906467", 
  "CS926615", 
  "CS942247", 
  "CS960617", 
  "CS98023C",	
  "CSAS023C",
  # I don't feel safe at this school.
  "CS884146", 
  "CS906469", 
  "CS926617", 
  "CS942249", 
  "CS960619", 
  "CS98023D",	
  "CSAS023D",
  # Most of my teachers don't know their subjects well.
  "CS884147", 
  "CS906471", 
  "CS926619", 
  "CS942251", 
  "CS960621", 
  "CS98023E",	
  "CSAS023E",
  # You can get away with almost anything at this school.
  "CS884148", 
  "CS906473", 
  "CS92662", 
  "CS942253", 
  "CS960623", 
  "CS98023F",	
  "CSAS023F",
  # My schoolwork requires me to think to the best of my abilities.
  "CS884149", 
  "CS906475", 
  "CS926623", 
  "CS942255", 
  "CS960625", 
  "CS98023G",	
  "CSAS023G",
  # At this school, a person has the freedom to learn what interests him or her.
  "CS884150", 
  "CS906477", 
  "CS926625", 
  "CS942257", 
  "CS960627", 
  "CS98023H",	
  "CSAS023H"
)


```



# Creating Long Dataframes

```{r Creating Long Dataframes}
years_names <- 1:14 
for (i in 1:14) {
  years_names[i] <- paste0("ever_", i*2+1986)
}

nlsy_longitudinal <- nlsy %>% 
  pivot_longer(cols = all_of(years_names), names_to = "years")
nlsy_longitudinal$value <- tolower(nlsy_longitudinal$value) %>% 
  factor()
nlsy_longitudinal$years <- sub("ever_","",  nlsy_longitudinal$years) %>% 
  as.numeric()
nlsy_longitudinal <- nlsy_longitudinal %>% 
  mutate(
    school_age = years - birth_year
  )
nlsy_longitudinal <- nlsy_longitudinal %>% 
  filter(school_age <= 18)
nlsy_l <- completeFun(nlsy_longitudinal, "value")
nlsy_l$school_group <- factor(nlsy_l$school_age)
nlsy_l$school_group <- forcats::fct_collapse(nlsy_l$school_group,
                                             elementary = c("3",  "4",  "5",  "6" , 
                                                            "7",  "8" , "9" , "10"),
                                             middle = c("11", "12" ,"13" ), 
                                             high = c("14","18"))
table(nlsy_l$school_group)
```

# Exporting Data

```{r}
save(nlsy, add, nlsy_l, file= "data.rdata")
save(NLSY_MINI_IPIP_QUESTIONS, NLSY_PERSONALITY_COR, NLSY_PERSONALITY_CORMAT_FULL, ADD_MINI_IPIP_COR, add_mini_ipip_questions, file = "personality_measures.rdata")
```


# NO BELOW THIS LINE, OLD STATS


# Descriptives

## Tables

```{r Participant Demographics Table}
nlsy %>% 
  group_by(race, sex) %>% 
  count() %>% 
  knitr::kable()

add %>% 
  group_by(race, sex) %>% 
  count() %>% 
  knitr::kable()
```

```{r Participant Demographics Figure}
nlsy %>% 
  ggplot() +
  geom_bar(aes(race, fill = sex),
           position = "dodge") +
  theme(legend.title = element_blank()) +
  labs(
    x = "Race",
    y = "N"
  )

add %>% 
  ggplot() +
  geom_bar(aes(race, fill = sex),
           position = "dodge") +
  theme(legend.title = element_blank()) +
  labs(
    x = "Race",
    y = "N"
  )
```

```{r}
##### NLSY
proportion <- nlsy %>% 
  group_by(sex, ever_suspended) %>% 
  count() %>% 
  na.omit()
proportion <- spread(proportion, key = ever_suspended, value = n) %>% 
  tibble(.)
proportion$total <- proportion$No + proportion$Yes
proportion$prop <- round(proportion$Yes/proportion$total, 2)
colnames(proportion) <- c("Sex", "Not Suspended", "Suspended", "N", "Proportion")
NLSY_proportion <- proportion
knitr::kable(NLSY_proportion)

####### ADD HEALTH

proportion <- add %>% 
  group_by(sex, ever_suspended) %>% 
  count() %>% 
  na.omit()
proportion <- spread(proportion, key = ever_suspended, value = n) %>% 
  tibble(.)
proportion$total <- proportion$no + proportion$yes
proportion$prop <- round(proportion$yes/proportion$total, 2)
colnames(proportion) <- c("Sex", "Not Suspended", "Suspended", "N", "Proportion")
ADD_proportion <- proportion
knitr::kable(ADD_proportion)

NLSY_proportion %>% 
  ggplot() +
    geom_col(aes(Sex, (Proportion * 100)),
             position = "dodge") +
  labs(title = "Proportion of Students Suspended by Gender",
       subtitle = "NLSY",
       caption = "If bigger bar, disproportiate % of that group are suspended",
       x = "Race",
       y = "Percent of students") +
  theme(legend.position = "none") 

ADD_proportion %>% 
  ggplot() +
    geom_col(aes(Sex, (Proportion * 100)),
             position = "dodge") +
  labs(title = "Proportion of Students Suspended by Race and Gender",
       subtitle = "ADD Health",
       caption = "If bigger bar, disproportiate % of that group are suspended",
       x = "Race",
       y = "Percent of students") +
  theme(legend.position = "none") 
```

```{r Proportion of Suspensions X Race X Gender Table}
##### NLSY
proportion <- nlsy %>% 
  group_by(race, sex, ever_suspended) %>% 
  count() %>% 
  na.omit()
proportion <- spread(proportion, key = ever_suspended, value = n) %>% 
  tibble(.)
proportion$total <- proportion$No + proportion$Yes
proportion$prop <- round(proportion$Yes/proportion$total, 2)
colnames(proportion) <- c("Race", "Sex", "Not Suspended", "Suspended", "N", "Proportion")
NLSY_proportion <- proportion
knitr::kable(NLSY_proportion)

####### ADD HEALTH

proportion <- add %>% 
  group_by(race, sex, ever_suspended) %>% 
  count() %>% 
  na.omit()
proportion <- spread(proportion, key = ever_suspended, value = n) %>% 
  tibble(.)
proportion$total <- proportion$no + proportion$yes
proportion$prop <- round(proportion$yes/proportion$total, 2)
colnames(proportion) <- c("Race", "Sex", "Not Suspended", "Suspended", "N", "Proportion")
ADD_proportion <- proportion
knitr::kable(ADD_proportion)
```

```{r Proportion of Suspensions X Race X Gender Figure}
NLSY_proportion %>% 
  ggplot() +
    geom_col(aes(Race, (Proportion * 100), fill = Sex),
             position = "dodge") +
  labs(title = "Proportion of Students Suspended by Race and Gender",
       subtitle = "NLSY",
       caption = "If bigger bar, disproportiate % of that group are suspended",
       x = "Race",
       y = "Percent of students") +
  theme(legend.position = "none") 

ADD_proportion %>% 
  ggplot() +
    geom_col(aes(Race, (Proportion * 100), fill = Sex),
             position = "dodge") +
  labs(title = "Proportion of Students Suspended by Race and Gender",
       subtitle = "ADD Health",
       caption = "If bigger bar, disproportiate % of that group are suspended",
       x = "Race",
       y = "Percent of students") +
  theme(legend.position = "none") 
```

# Inferential Statistics

## Race X Gender Effects

```{r NLSY INXN BT Race and Sex, results='asis'}
nlsy_race_sex_model <- glm(ever_suspended ~ race * sex,
             family = binomial, data = nlsy)
summary(nlsy_race_sex_model)

plot_model(nlsy_race_sex_model, type = "pred", terms = c("race", "sex"))

nlsy_suspend_fig <- emmeans(nlsy_race_sex_model, specs = pairwise ~ race | sex,
                 type = "response", adjust = "none")

nlsy_suspend_fig
```

```{r ADD INXN BT Race and Sex, results='asis'}
add_race_sex_model <- glm(ever_suspended ~ race * sex,
             family = binomial, data = add)
summary(add_race_sex_model)

plot_model(add_race_sex_model, type = "pred", terms = c("race", "sex"))

add_suspend_fig <- emmeans(add_race_sex_model, specs = pairwise ~ race | sex,
                 type = "response", adjust = "none")
add_suspend_fig
```

> This is a reproduction of prior analytic work that shows yes, there are *large racial differences in suspension rate*. 
## Extraversion

## Extraversion 

```{r NLSY Extraversion TIPI}
extrav <- glm(ever_suspended ~ race * sex * extra_tipi,
             family = binomial, data = nlsy)
summary(extrav)

plot_model(extrav, type = "pred", terms = c("extra_tipi", "race", "sex"))

object1 <- emtrends(extrav, pairwise ~ race*sex, var = "extra_tipi", adjust = "none")
object1
```

```{r NLSY Extraversion Mini-IPIP}
extrav <- glm(ever_suspended ~ race * sex * extrav_mi,
             family = binomial, data = nlsy)
summary(extrav)

plot_model(extrav, type = "pred", terms = c("extrav_mi", "race", "sex"))

object1 <- emtrends(extrav, pairwise ~ race*sex, var = "extrav_mi", adjust = "none")
object1
```

```{r ADD Extraversion Mini-IPIP}
extrav <- glm(ever_suspended ~ race * sex * extrav,
             family = binomial, data = add)
summary(extrav)

plot_model(extrav, type = "pred", terms = c("extrav", "race", "sex"))

object1 <- emtrends(extrav, pairwise ~ race*sex, var = "extrav", adjust = "none")
object1
```

> Extraversion seems to be a risk factor for Black students in the ADD Health sample, but not in the NLSY (either through the TIPI or the Mini-IPIP)


## Agreeableness 

```{r NLSY Agreeableness tipi}
agree <- glm(ever_suspended ~ race * sex * agree_tipi,
             family = binomial, data = nlsy)
summary(agree)

plot_model(agree, type = "pred", terms = c("agree_tipi", "race", "sex"))

object1 <- emtrends(agree, pairwise ~ race*sex, var = "agree_tipi", adjust = "none")
object1
```

```{r NLSY Agreeableness mi}
agree <- glm(ever_suspended ~ race * sex * agree_mi,
             family = binomial, data = nlsy)
summary(agree)

plot_model(agree, type = "pred", terms = c("agree_mi", "race", "sex"))

object1 <- emtrends(agree, pairwise ~ race*sex, var = "agree_mi", adjust = "none")
object1
```

```{r ADD Agreeableness mi}
agree <- glm(ever_suspended ~ race * sex * agree,
             family = binomial, data = add)
summary(agree)

plot_model(agree, type = "pred", terms = c("agree", "race", "sex"))

object1 <- emtrends(agree, pairwise ~ race*sex, var = "agree", adjust = "none")
object1
```

> Agreeableness is as predicted

## Conscientiousness 

```{r NLSY Conscientiousness tipi}
consc <- glm(ever_suspended ~ race * sex * consc_tipi,
             family = binomial, data = nlsy)
summary(consc)

plot_model(consc, type = "pred", terms = c("consc_tipi", "race", "sex"))

object1 <- emtrends(consc, pairwise ~ race*sex, var = "consc_tipi", adjust = "none")
object1
```

```{r NLSY Conscientiousness mi}
consc <- glm(ever_suspended ~ race * sex * consc_mi,
             family = binomial, data = nlsy)
summary(consc)

plot_model(consc, type = "pred", terms = c("consc_mi", "race", "sex"))

object1 <- emtrends(consc, pairwise ~ race*sex, var = "consc_mi", adjust = "none")
object1
```

```{r ADD Conscientiousness mi}
consc <- glm(ever_suspended ~ race * sex * consc,
             family = binomial, data = add)
summary(consc)

plot_model(consc, type = "pred", terms = c("consc", "race", "sex"))

object1 <- emtrends(consc, pairwise ~ race*sex, var = "consc", adjust = "none")
object1
```


## Emotional Stability (Neuro) 

```{r NLSY Emotional Stability tipi}
neuro <- glm(ever_suspended ~ race * sex * neuro_tipi,
             family = binomial, data = nlsy)
summary(neuro)

plot_model(neuro, type = "pred", terms = c("neuro_tipi", "race", "sex"))

object1 <- emtrends(neuro, pairwise ~ race*sex, var = "neuro_tipi", adjust = "none")
object1
```

```{r NLSY Emotional Stability mi}
neuro <- glm(ever_suspended ~ race * sex * neuro_mi,
             family = binomial, data = nlsy)
summary(neuro)

plot_model(neuro, type = "pred", terms = c("neuro_mi", "race", "sex"))

object1 <- emtrends(neuro, pairwise ~ race*sex, var = "neuro_mi", adjust = "none")
object1
```

```{r ADD Emotional Stability mi}
neuro <- glm(ever_suspended ~ race * sex * neuro,
             family = binomial, data = add)
summary(neuro)

plot_model(neuro, type = "pred", terms = c("neuro", "race", "sex"))

object1 <- emtrends(neuro, pairwise ~ race*sex, var = "neuro", adjust = "none")
object1
```

## Openness

```{r NLSY Openness tipi}
open <- glm(ever_suspended ~ race * sex * open_tipi,
             family = binomial, data = nlsy)
summary(open)

plot_model(open, type = "pred", terms = c("open_tipi", "race", "sex"))

object1 <- emtrends(open, pairwise ~ race*sex, var = "open_tipi", adjust = "none")
object1
```

```{r NLSY Openness mi}
open <- glm(ever_suspended ~ race * sex * open_mi,
             family = binomial, data = nlsy)
summary(open)

plot_model(open, type = "pred", terms = c("open_mi", "race", "sex"))

object1 <- emtrends(open, pairwise ~ race*sex, var = "open_mi", adjust = "none")
object1
```

```{r ADD Openness mi}
open <- glm(ever_suspended ~ race * sex * open,
             family = binomial, data = add)
summary(open)

plot_model(open, type = "pred", terms = c("open", "race", "sex"))

object1 <- emtrends(open, pairwise ~ race*sex, var = "open", adjust = "none")
object1
```

# Sensitivity Analysis: Examining Variance with Loaded Models

## NLSY TIPI Variance Models

```{r NLSY TIPI Variance Models}
# Model 
nlsy_tipi_variance_model <- glm(ever_suspended ~ 
                                  race * sex * extra_tipi + 
                                  race * sex * agree_tipi + 
                                  race * sex * neuro_tipi + 
                                  race * sex * consc_tipi + 
                                  race * sex * open_tipi,
             family = binomial, data = )

summary(nlsy_tipi_variance_model)

#### EXTRAVERSION
plot_model(nlsy_tipi_variance_model, 
           type = "pred", 
           terms = c("extra_tipi", "race", "sex"))

nlsy_extra_tipi_var_model <- emtrends(nlsy_tipi_variance_model, 
                    pairwise ~ race*sex, 
                    var = "extra_tipi", 
                    adjust = "none")
nlsy_extra_tipi_var_model

#### AGREEABLENESS
plot_model(nlsy_tipi_variance_model, 
           type = "pred", 
           terms = c("agree_tipi", "race", "sex"))

nlsy_agree_tipi_var_model <- emtrends(nlsy_tipi_variance_model, 
                    pairwise ~ race*sex, 
                    var = "agree_tipi", 
                    adjust = "none")
nlsy_agree_tipi_var_model

#### EMOTIONAL STABILITY
plot_model(nlsy_tipi_variance_model, 
           type = "pred", 
           terms = c("neuro_tipi", "race", "sex"))

nlsy_neuro_tipi_var_model <- emtrends(nlsy_tipi_variance_model, 
                    pairwise ~ race*sex, 
                    var = "neuro_tipi", 
                    adjust = "none")
nlsy_neuro_tipi_var_model

#### CONSCIENTIOUSNESS
plot_model(nlsy_tipi_variance_model, 
           type = "pred", 
           terms = c("consc_tipi", "race", "sex"))

nlsy_consc_var_model <- emtrends(nlsy_tipi_variance_model, 
                    pairwise ~ race*sex, 
                    var = "consc_tipi", 
                    adjust = "none")
nlsy_consc_var_model

#### OPENNESS
plot_model(nlsy_tipi_variance_model, 
           type = "pred", 
           terms = c("open_tipi", "race", "sex"))

nlsy_open_tipi_var_model <- emtrends(nlsy_tipi_variance_model, 
                    pairwise ~ race*sex, 
                    var = "open_tipi", 
                    adjust = "none")
nlsy_open_tipi_var_model
```

## NLSY MINI-IPIP Variance Models

```{r NLSY MINI-IPIP Variance Models}
## Model 
nlsy_mini_ipip_variance_model <- glm(ever_suspended ~ 
                                  race * sex * extrav_mi + 
                                  race * sex * agree_mi + 
                                  race * sex * neuro_mi + 
                                  race * sex * consc_mi + 
                                  race * sex * open_mi,
             family = binomial, data = nlsy)

summary(nlsy_mini_ipip_variance_model)

#### EXTRAVERSION
plot_model(nlsy_mini_ipip_variance_model, 
           type = "pred", 
           terms = c("extrav_mi", "race", "sex"))

nlsy_extra_mini_ipip_var_model <- emtrends(nlsy_mini_ipip_variance_model, 
                    pairwise ~ race*sex, 
                    var = "extrav_mi", 
                    adjust = "none")
nlsy_extra_mini_ipip_var_model

#### AGREEABLENESS
plot_model(nlsy_mini_ipip_variance_model, 
           type = "pred", 
           terms = c("agree_mi", "race", "sex"))

nlsy_agree_mini_ipip_var_model <- emtrends(nlsy_mini_ipip_variance_model, 
                    pairwise ~ race*sex, 
                    var = "agree_mi", 
                    adjust = "none")
nlsy_agree_mini_ipip_var_model

#### EMOTIONAL STABILITY
plot_model(nlsy_mini_ipip_variance_model, 
           type = "pred", 
           terms = c("neuro_mi", "race", "sex"))

nlsy_neuro_mini_ipip_var_model <- emtrends(nlsy_mini_ipip_variance_model, 
                    pairwise ~ race*sex, 
                    var = "neuro_mi", 
                    adjust = "none")
nlsy_neuro_mini_ipip_var_model

#### CONSCIENTIOUSNESS
plot_model(nlsy_mini_ipip_variance_model, 
           type = "pred", 
           terms = c("consc_mi", "race", "sex"))

nlsy_consc_mini_ipip_var_model <- emtrends(nlsy_mini_ipip_variance_model, 
                    pairwise ~ race*sex, 
                    var = "consc_mi", 
                    adjust = "none")
nlsy_consc_mini_ipip_var_model

#### OPENNESS
plot_model(nlsy_mini_ipip_variance_model, 
           type = "pred", 
           terms = c("open_mi", "race", "sex"))

nlsy_open_mini_ipip_var_model <- emtrends(nlsy_mini_ipip_variance_model, 
                    pairwise ~ race*sex, 
                    var = "open_mi", 
                    adjust = "none")
nlsy_open_mini_ipip_var_model
```


## ADD Health Variance Models

```{r Add Health Variance Models}
# Model 
add_variance_model <- glm(ever_suspended ~ 
                            race * sex * open + 
                            race * sex * extrav + 
                            race * sex * agree + 
                            race * sex * neuro + 
                            race * sex * consc,
             family = binomial, data = add)

summary(add_variance_model)

#### EXTRAVERSION
plot_model(add_variance_model, 
           type = "pred", 
           terms = c("extrav", "race", "sex"))

add_extra_variance_model <- emtrends(add_variance_model, 
                    pairwise ~ race*sex, 
                    var = "extrav", 
                    adjust = "none")
add_extra_variance_model

#### AGREEABLENESS
plot_model(add_variance_model, 
           type = "pred", 
           terms = c("agree", "race", "sex"))

add_agree_variance_model <- emtrends(add_variance_model, 
                    pairwise ~ race*sex, 
                    var = "agree", 
                    adjust = "none")
add_agree_variance_model

#### EMOTIONAL STABILITY
plot_model(add_variance_model, 
           type = "pred", 
           terms = c("neuro", "race", "sex"))

add_neuro_variance_model <- emtrends(add_variance_model, 
                    pairwise ~ race*sex, 
                    var = "neuro", 
                    adjust = "none")
add_neuro_variance_model

#### CONSCIENTIOUSNESS
plot_model(add_variance_model, 
           type = "pred", 
           terms = c("consc", "race", "sex"))

add_consc_variance_model <- emtrends(add_variance_model, 
                    pairwise ~ race*sex, 
                    var = "consc", 
                    adjust = "none")
add_consc_variance_model

#### OPENNESS
plot_model(add_variance_model, 
           type = "pred", 
           terms = c("open", "race", "sex"))

add_open_variance_model <- emtrends(add_variance_model, 
                    pairwise ~ race*sex, 
                    var = "open", 
                    adjust = "none")
add_open_variance_model
```

# Exploratory (Add Health)

## Anger

```{r Add Anger}
anger <- glm(ever_suspended ~ race * sex * anger,
             family = binomial, data = add)
summary(anger)

plot_model(anger, type = "pred", terms = c("anger", "race", "sex"))

object1 <- emtrends(anger, pairwise ~ race*sex, var = "anger", adjust = "none")
object1
```



## Optimism

```{r Add Optimism}
optimism <- glm(ever_suspended ~ race * sex * optimism,
             family = binomial, data = add)
summary(optimism)

plot_model(optimism, type = "pred", terms = c("optimism", "race", "sex"))

object1 <- emtrends(optimism, pairwise ~ race*sex, var = "optimism", adjust = "none")
object1
```


## Anxiety 

```{r Add Anxiety}
anxiety <- glm(ever_suspended ~ race * sex * anxiety,
             family = binomial, data = add)
summary(anxiety)

plot_model(anxiety, type = "pred", terms = c("anxiety", "race", "sex"))

object1 <- emtrends(anxiety, pairwise ~ race*sex, var = "anxiety", adjust = "none")
object1
```

# Longitudinal Analyses

## Extraversion
```{r NLSY Extraversion Longitudinal}
extrav <- glm(value ~ race * sex * extra_tipi * school_group,
             family = binomial, data = nlsy_l)
summary(extrav)

plot_model(extrav, type = "pred", terms = c("extra_tipi", "race", "sex", "school_group"))

object1 <- emtrends(extrav, pairwise ~ race * sex * school_group, var = "extra_tipi", adjust = "none")
object1
```


## Agreeableness

```{r NLSY Agreeableness Longitudinal}
agree <- glm(ever_suspended ~ race * sex * agree_tipi * school_group,
             family = binomial, data = nlsy_l)
summary(agree)

plot_model(agree, type = "pred", terms = c("agree_tipi", "race", "sex", "school_group"))

object1 <- emtrends(agree, pairwise ~ race * sex * school_group, var = "agree_tipi", adjust = "none")
object1$contrasts
```

## Neuroticism 

```{r NLSY Neuroticism Longitudinal}
neuro <- glm(ever_suspended ~ race * sex * neuro_tipi * school_group,
             family = binomial, data = nlsy_l)
summary(neuro)

plot_model(neuro, type = "pred", terms = c("neuro_tipi", "race", "sex", "school_group"))

object1 <- emtrends(neuro, pairwise ~ race * sex * school_group, var = "neuro_tipi", adjust = "none")
object1$contrasts

```



## Conscientiousness 

```{r NLSY Conscientiousness Longitudinal}
cons <- glm(ever_suspended ~ race * sex * consc_tipi * school_group,
             family = binomial, data = nlsy_l)
summary(cons)

plot_model(cons, type = "pred", terms = c("consc_tipi", "race", "sex", "school_group"))

object1 <- emtrends(cons, pairwise ~ race * sex * school_group, var = "consc_tipi", adjust = "none")
object1
```

> More protective in hispanic elem than hispanic middle school women: -0.29, p = 0.048)

## Openness 

```{r NLSY Openness Longitudinal}
open <- glm(ever_suspended ~ race * sex * open_tipi * school_group,
             family = binomial, data = nlsy_l)
summary(open)

plot_model(open, type = "pred", terms = c("open_tipi", "race", "sex", "school_group"))

object1 <- emtrends(open, pairwise ~ race * sex * school_group, var = "open_tipi", adjust = "none")
object1
```

#
## Sensitivity Analyses
#
#```{r nlsy_sens Cormat}
#nlsy_sens <- nlsy
#
#nlsy_sens_long <- tibble(
#  "pid" = rep(nlsy_sens$pid, 2),
#  "race" = rep(nlsy_sens$race, 2),
#  "sex" = rep(nlsy_sens$sex, 2),
#  "ever_suspended" = rep(nlsy_sens$ever_suspended, 2),
#  "extraversion" = c(nlsy_sens$extra_tipi, nlsy_sens$extrav_mi),
#  "agreeableness" = c(nlsy_sens$agree_tipi, nlsy_sens$agree_mi),
#  "conscientiousness" = c(nlsy_sens$consc_tipi, nlsy_sens$consc_mi),
#  "neuroticism" = c(nlsy_sens$neuro_tipi, nlsy_sens$neuro_mi),
#  "openness" = c(nlsy_sens$open_tipi, nlsy_sens$open_mi),
#  "measure" = c(rep("tipi", nrow(nlsy_sens)), rep("consc_mi", nrow(nlsy_sens)))
#                )
#```
#
### Extraversion
#
#```{r NLSY Extraversion Sensitivity}
#extrav = nlsy_sens %>% 
#  select(ever_suspended, race, sex, extra_tipi, extrav_mi, pid) %>% 
#  mutate(across(starts_with("extra"), pomp)) %>% 
#  pivot_longer(cols = c(extra_tipi, extrav_mi),
#               names_sep = "_", names_to = c("trait", "scale"),
#               values_to = "score") %>% 
#  filter(!is.nan(score)) %>% 
#  with_groups(pid, ~mutate(., n=n())) %>% 
#  filter(n == 2) %>% 
#  glmer(ever_suspended ~   sex*race*score*scale + (1|pid),
#             family = binomial, data = .)
#summary(extrav)
#
#plot_model(extrav, type = "pred", terms = c("score", "scale", "race"))
#
#```
#
### Agreeableness
#
#```{r NLSY Agreeableness Sensitivity}
#agree = nlsy_sens %>% 
#  select(ever_suspended, race, sex, agree_tipi, agree_mi, pid) %>% 
#  mutate(across(starts_with("agree"), pomp)) %>% 
#  pivot_longer(cols = c(agree_tipi, agree_mi),
#               names_sep = "_", names_to = c("trait", "scale"),
#               values_to = "score") %>% 
#  filter(!is.nan(score)) %>% 
#  with_groups(pid, ~mutate(., n=n())) %>% 
#  filter(n == 2) %>% 
#  glmer(ever_suspended ~   sex*race*score*scale + (1|pid),
#             family = binomial, data = .)
#summary(agree)
#
#plot_model(agree, type = "pred", terms = c("score", "scale", "race"))
#```
#
### Neuroticism 
#
#```{r NLSY Neuroticism Sensitivity}
#neuro = nlsy_sens %>% 
#  select(ever_suspended, race, sex, neuro_tipi, neuro_mi, pid) %>% 
#  mutate(across(starts_with("neuro"), pomp)) %>% 
#  pivot_longer(cols = c(neuro_tipi, neuro_mi),
#               names_sep = "_", names_to = c("trait", "scale"),
#               values_to = "score") %>% 
#  filter(!is.nan(score)) %>% 
#  with_groups(pid, ~mutate(., n=n())) %>% 
#  filter(n == 2) %>% 
#  glmer(ever_suspended ~   sex*race*score*scale + (1|pid),
#             family = binomial, data = .)
#
#summary(neuro)
#
#plot_model(neuro, type = "pred", terms = c("score", "scale", "race"))
#```
#
### Conscientiousness 
#
#```{r NLSY Conscientiousness Sensitivity}
#cons <- nlsy_sens %>% 
#  select(ever_suspended, race, sex, consc_tipi, consc_mi, pid) %>% 
#  mutate(across(starts_with("neuro"), pomp)) %>% 
#  pivot_longer(cols = c(consc_tipi, consc_mi),
#               names_sep = "_", names_to = c("trait", "scale"),
#               values_to = "score") %>% 
#  filter(!is.nan(score)) %>% 
#  with_groups(pid, ~mutate(., n=n())) %>% 
#  filter(n == 2) %>% 
#  glmer(ever_suspended ~   sex*race*score*scale + (1|pid),
#             family = binomial, data = .)
#summary(cons)
#
#plot_model(cons, type = "pred", terms = c("consc", "consc_mi", "race", "sex"))
#```
#
### Openness 
#
#```{r NLSY Openness Sensitivity}
#open <- nlsy_sens %>% 
#  select(ever_suspended, race, sex, open_tipi, open_mi, pid) %>% 
#  mutate(across(starts_with("neuro"), pomp)) %>% 
#  pivot_longer(cols = c(open_tipi, open_mi),
#               names_sep = "_", names_to = c("trait", "scale"),
#               values_to = "score") %>% 
#  filter(!is.nan(score)) %>% 
#  with_groups(pid, ~mutate(., n=n())) %>% 
#  filter(n == 2) %>% 
#  glmer(ever_suspended ~   sex*race*score*scale + (1|pid),
#             family = binomial, data = .)
#summary(cons)
#
#plot_model(cons, type = "pred", terms = c("open_tipi", "open_mi", "race", "sex"))
#```
#
#
#
#